(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Args:()=>st,Colour:()=>Ct,Engine:()=>re,EventTrigger:()=>Et,Id:()=>at,Interval:()=>ut,Iterator:()=>k,Light:()=>Ut,LightColourGuiAdaptor:()=>se,LightPositionGuiAdaptor:()=>ae,ObjectFactory:()=>ee,RasterRenderer:()=>qt,RaytraceRenderer:()=>ne,Vec3:()=>Tt,VectorRenderer:()=>oe,World:()=>Yt,addClass:()=>bt,addProperty:()=>ot,array:()=>K,callbackWithContext:()=>ct,clamp:()=>lt,cloneProperties:()=>Q,collect:()=>H,contains:()=>Z,copyProperties:()=>J,defaultValue:()=>rt,download:()=>ht,each:()=>A,eachProperty:()=>C,every:()=>P,filter:()=>G,find:()=>I,findAll:()=>B,findIndex:()=>D,flatten:()=>W,forEach:()=>x,forLoop:()=>T,getElementById:()=>ft,getElements:()=>gt,getElementsByClassName:()=>mt,getElementsByTagName:()=>pt,gui:()=>gn,hasClass:()=>_t,includes:()=>M,isDefined:()=>r,isDefinedAndNotNull:()=>s,isEmpty:()=>w,isEqualTo:()=>u,isFalsey:()=>l,isGreaterOrEqual:()=>p,isGreaterThan:()=>f,isLengthEqualTo:()=>m,isLengthGreaterOrEqualTo:()=>v,isLengthGreaterThan:()=>b,isLengthLessOrEqualTo:()=>g,isLengthLessThan:()=>_,isLessOrEqualTo:()=>h,isLessThan:()=>d,isNotEmpty:()=>y,isNotNull:()=>i,isNull:()=>n,isTruthy:()=>c,isUndefined:()=>o,isUndefinedOrNull:()=>a,iterate:()=>O,keys:()=>et,loop:()=>F,map:()=>V,max:()=>N,measureClientWindow:()=>wt,measureElement:()=>yt,mergeProperties:()=>E,min:()=>L,next:()=>X,onTimeout:()=>dt,polyFillRequestAnimationFrame:()=>xt,popEach:()=>q,previous:()=>$,propertiesToArray:()=>it,pushAll:()=>Y,remove:()=>U,removeAll:()=>j,removeClass:()=>vt,size:()=>tt,swap:()=>z,toggleFullScreen:()=>At,untilLoop:()=>S,values:()=>nt,whileLoop:()=>R});const n=function(t){return null===t},i=function(t){return null!==t},o=function(t){return void 0===t},r=function(t){return void 0!==t},s=function(t){return null!=t},a=function(t){return null==t},c=function(t){return s(t)&&(!0===t||t>0||"string"==typeof t&&"true"===t.toLowerCase())},l=function(t){return!1===c(t)},u=function(t,e){return null!=t&&t==e},h=function(t,e){return null!=t&&t<=e},d=function(t,e){return null!=t&&t<e},f=function(t,e){return null!=t&&t>e},p=function(t,e){return null!=t&&t>=e},m=function(t,e){return null!=t&&t.length==e},g=function(t,e){return null!=t&&t.length<=e},_=function(t,e){return null!=t&&t.length<e},b=function(t,e){return null!=t&&t.length>e},v=function(t,e){return null!=t&&t.length>=e},y=function(t){return null!=t&&t.length>0},w=function(t){return null!=t&&0==t.length},E=function(t,e){let n,i,o,s=Object.keys(e);for(n=0;n<s.length;n+=1)i=s[n],e.hasOwnProperty(i)&&(o=e[i],r(o)&&(t[i]=o));return t},A=function(t,e,n){let i=null;return t instanceof Array||"string"==typeof t?x(t,e,n):s(t.iterator)?(i=t.iterator(),i instanceof k&&i.iterate(e,n)):t instanceof Number?F(t,e,n):C(t,e,n),t},x=function(t,e,n){const i=n||this;for(let n=0;n<t.length;n+=1)e.call(i,t[n],n);return t},C=function(t,e,n){const i=Object.keys(t),o=n||this;for(let n=0;n<i.length;n+=1){let r=i[n];e.call(o,r,t[r],n)}return t},F=function(t,e,n){const i=n||this;for(let n=0;n<t;n+=1)e.call(i,n)},R=function(t,e,n){const i=n||this;let o=0;for(;t;)e.call(i,o),o+=1},S=function(t,e,n){const i=n||this;let o=0;do{e.call(i,o),o+=1}while(t)},T=function(t,e,n,i,o){const r=o||this;let s;for(s=e;s<n;s+=1)i.call(r,s)},k=function(t){this._node=t,this.hasNext=function(){return null!==this._node},this.next=function(){let e=null;if(t)return e=this._node.data,this._node=this._node.next,e},this.iterate=function(t,e){let n=0;for(;this.hasNext();)t.call(e||this,this.next(),n),n+=1}},O=function(t,e,n){t.iterator().iterate(e,n)},L=function(t,e){let n=t[0],i=null;for(let o=0;o<t.length;o+=1)i=t[o],e(i,n)<0&&(n=i);return n},N=function(t,e){let n=t[0],i=null;for(let o=0;o<t.length;o+=1)i=t[o],e(i,n)>0&&(n=i);return n},D=function(t,e){let n=-1;for(let i=0;i<t.length;i+=1)if(e(t[i])){n=i;break}return n},I=function(t,e){let n,i;for(let o=0;o<t.length;o+=1)if(i=t[o],e(i)){n=i;break}return n},B=function(t,e){const n=[];let i=null;for(let o=0;o<t.length;o+=1)i=t[o],e(i)&&n.push(i);return n},M=function(t,e,n){return D(t,n||function(t){return t===e})>-1},P=function(t,e){for(let n=0;n<t.length;n+=1)if(!e(t[n]))return!1;return!0},H=function(t,e){const n=[];let i=null;for(let o=0;o<t.length;o+=1)i=t[o],e(i)&&n.push(i);return n},G=function(t,e){const n=[];let i=null;for(let o=0;o<t.length;o+=1)i=t[o],e(i)||n.push(i);return n},U=function(t,e){var n=D(t,e);return n>-1&&t.splice(n,1),t},j=function(t,e){const n=t.splice(0);let i=null;t.length=0;for(let o=0;o<n.length;o+=1)i=n[o],e(i)||t.push(i);return t},V=function(t,e){const n=[];for(let i=0;i<t.length;i+=1)n.push(e(t[i]));return n},W=function(t){const e=[];let n=null;for(let i=0;i<t.length;i+=1)if(t[i]instanceof Array){n=this.flatten(t[i]);for(let t=0;t<n.length;t+=1)e.push(n[t])}else e.push(t[i]);return e},z=function(t,e,n){let i=null;return e<t.length&&n<t.length&&(i=t[e],t[e]=t[n],t[n]=i),t},Y=function(t,e){for(let n=0;n<e.length;n+=1)t.push(e[n]);return t},q=function(t,e,n){const i=n||this;for(;t.length>0;)e.apply(i,t.pop());return t},K=function(){const t=[];for(let e=0;e<arguments.length;e+=1)t.push(arguments[e]);return t},X=function(t,e){const n=e+1;return t[n===t.length?0:n]},$=function(t,e){const n=e-1;return t[n<0?t.length-1:n]},Q=function(t){return J({},t)},J=function(t,e){return C(e,(function(e,n){t[e]=n})),t},Z=function(t,e){return r(t[e])},tt=function(t){let e=0;for(let n in t)t.hasOwnProperty(n)&&(e+=1);return e},et=function(t){const e=[];for(let n in t)t.hasOwnProperty(n)&&e.push(n);return e},nt=function(t){const e=[];for(let n in t)t.hasOwnProperty(n)&&e.push(t[n]);return e},it=function(t){const e=[];return C(t,(function(t,n){null[t]=n,e.push(null)})),e},ot=function(t,e,n){return t[e]=n,t},rt=function(t,e){return s(t)?t:e},st=function(t){this._robustIsSameType=function(t,e){return t.constructor===e||t instanceof e},this.init(t)};st.prototype.init=function(t){return this._args=t,this},st.prototype.empty=function(){return 0===this._args.length},st.prototype.size=function(){return this._args.length},st.prototype.get=function(t){let e=null;return this.empty()||(e=this._args[t]),e},st.prototype.matches=function(){const t=arguments;let e=!0;if(t.length!==this._args.length)e=!1;else for(let n=0;n<t.length;n+=1)this._robustIsSameType(this._args[n],t[n])||(e=!1);return e},st.prototype.match=function(t,e){const n=this.get(t);let i=!1;return n&&(i=this._robustIsSameType(n.constructor,e)),i},st.prototype.matchAll=function(t){let e=!0;for(let n=0;n<this._args.length;n+=1)this._robustIsSameType(this._args[n],t)||(e=!1);return e},st.prototype.toArray=function(){return Array.prototype.slice.call(this._args)},st.prototype.clone=function(){return new st(this._args)};const at=function(){let t=0;this.next=function(){return t+=1,t}},ct=function(t,e){return function(){return t.apply(e,arguments)}},lt=function(t,e,n){let i=null;return i=n>0?e:t,i},ut=function(t,e){this.init(t,e)};ut.clamp=function(t,e,n){let i=null;return i=t<=n&&t>=e?t:n<t?n:e,i},ut.prototype.init=function(t,e){this.min=t,this.max=e},ut.prototype.overlaps=function(t){return!(this.min>t.max||t.min>this.max)},ut.prototype.overlap=function(t){return this.overlaps(t)?Math.min(this.max,t.max)-Math.max(this.min,t.min):0},ut.prototype.contains=function(t){return t.min>this.min&&t.max<this.max},ut.prototype.clamp=function(t){return ut.clamp(t,this.min,this.max)};const ht=function(t,e,n){const i=document.createElement("a");i.download=t,i.href=e,i.dataset.downloadurl=[n,i.download,i.href].join(":"),document.body.appendChild(i),i.click(),document.body.removeChild(i)},dt=function(t,e){let n=null;return function(){clearTimeout(n),n=setTimeout(t,e)}},ft=function(t){return window.document.getElementById(t)},pt=function(t){return window.document.getElementsByTagName(t)},mt=function(t){return window.document.getElementsByClassName(t)},gt=function(t){return window.document.querySelectorAll(t)},_t=function(t,e){const n=t.className;let i=!1;return i=n.search(/\s/)?M(n.split(" "),e):n===e,i},bt=function(t,e){return t.classList.add(e),t},vt=function(t,e){return t.classList.remove(e),t},yt=function(t){return{width:t.offsetWidth,height:t.offsetHeight}},wt=function(){return{width:window.innerWidth||document.body.clientWidth,height:window.innerHeight||document.body.clientHeight}},Et=function(){this.init()};Et.prototype.init=function(){this.listeners=[]},Et.prototype.fire=function(){let t=null;for(let e=0;e<this.listeners.length;e++)t=this.listeners[e],t.handler.apply(t.context,arguments)},Et.prototype.bind=function(t,e,n){this.listeners.push({namespace:t,handler:e,context:n})},Et.prototype.unbind=function(t,e,n){U(this.listeners,(function(i){return i.namespace===t&&i.handler===e&&i.context===n}))},Et.prototype.destroy=function(){this.listeners=void 0};const At=function(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)},xt=function(){window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)}),window.cancelRequestAnimationFrame||(window.cancelRequestAnimationFrame=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.clearTimeout)},Ct=function(){};Ct.ALICE_BLUE="#F0F8FF",Ct.ANTIQUE_WHITE="#FAEBD7",Ct.AQUA="#00FFFF",Ct.AQUAMARINE="#7FFFD4",Ct.AZURE="#F0FFFF",Ct.BEIGE="#F5F5DC",Ct.BISQUE="#FFE4C4",Ct.BLACK="#000000",Ct.BLANCHED_ALMOND="#FFEBCD",Ct.BLUE="#0000FF",Ct.BLUE_VIOLET="#8A2BE2",Ct.BROWN="#A52A2A",Ct.BURLY_WOOD="#DEB887",Ct.CADET_BLUE="#5F9EA0",Ct.CHARTREUSE="#7FFF00",Ct.CHOCOLATE="#D2691E",Ct.CORAL="#FF7F50",Ct.CORNFLOWER_BLUE="#6495ED",Ct.CORNSILK="#FFF8DC",Ct.CRIMSON="#DC143C",Ct.CYAN="#00FFFF",Ct.DARK_BLUE="#00008B",Ct.DARK_CYAN="#008B8B",Ct.DARK_GOLDEN_RED="#B8860B",Ct.DARK_GRAY="#A9A9A9",Ct.DARK_GREEN="#006400",Ct.DARKKHAKI="#BDB76B",Ct.DARKMAGENTA="#8B008B",Ct.DARK_OLIVE_GREEN="#556B2F",Ct.DARK_ORANGE="#FF8C00",Ct.DARK_ORCHID="#9932CC",Ct.DARK_RED="#8B0000",Ct.DARK_SALMON="#E9967A",Ct.DARK_SEA_GREEN="#8FBC8F",Ct.DARK_SLATE_BLUE="#483D8B",Ct.DARK_SLATE_GRAY="#2F4F4F",Ct.DARK_TURQUOISE="#00CED1",Ct.DARK_VIOLET="#9400D3",Ct.DEEP_PINK="#FF1493",Ct.DEEP_SKY_BLUE="#00BFFF",Ct.DIM_GRAY="#696969",Ct.DODGER_BLUE="#1E90FF",Ct.FIREBRICK="#B22222",Ct.FLORAL_WHITE="#FFFAF0",Ct.FOREST_GREEN="#228B22",Ct.FUCHSIA="#FF00FF",Ct.GAINSBORO="#DCDCDC",Ct.GHOSTWHITE="#F8F8FF",Ct.GOLD="#FFD700",Ct.GOLDEN_RED="#DAA520",Ct.GRAY="#808080",Ct.GREEN="#008000",Ct.GREEN_YELLOW="#ADFF2F",Ct.HONEYDEW="#F0FFF0",Ct.HOT_PINK="#FF69B4",Ct.INDIAN_RED="#CD5C5C",Ct.INDIGO="#4B0082",Ct.IVORY="#FFFFF0",Ct.KHAKI="#F0E68C",Ct.LAVENDER="#E6E6FA",Ct.LAVENDER_BLUSH="#FFF0F5",Ct.LAWN_GREEN="#7CFC00",Ct.LEMON_CHIFFON="#FFFACD",Ct.LIGHT_BLUE="#ADD8E6",Ct.LIGHT_CORAL="#F08080",Ct.LIGHT_CYAN="#E0FFFF",Ct.LIGHT_GOLDEN_ROD_YELLOW="#FAFAD2",Ct.LIGHT_GREEN="#90EE90",Ct.LIGHTGREY="#D3D3D3",Ct.LIGHT_PINK="#FFB6C1",Ct.LIGHT_SALMON="#FFA07A",Ct.LIGHT_SEA_GREEN="#20B2AA",Ct.LIGHT_SKY_BLUE="#87CEFA",Ct.LIGHT_SLATE_GRAY="#778899",Ct.LIGHT_STEEL_BLUE="#B0C4DE",Ct.LIGHT_YELLOW="#FFFFE0",Ct.LIME="#00FF00",Ct.LIME_GREEN="#32CD32",Ct.LINEN="#FAF0E6",Ct.MAGENTA="#FF00FF",Ct.MAROON="#800000",Ct.MEDIUM_AUQAMARINE="#66CDAA",Ct.MEDIUM_BLUE="#0000CD",Ct.MEDIUM_ORCHID="#BA55D3",Ct.MEDIUM_PURPLE="#9370D8",Ct.MEDIUM_SEA_GREEN="#3CB371",Ct.MEDIUM_SLATE_BLUE="#7B68EE",Ct.MEDIUM_SPRING_GREEN="#00FA9A",Ct.MEDIUM_TURQUOISE="#48D1CC",Ct.MEDIUM_VIOLET_RED="#C71585",Ct.MIDNIGHT_BLUE="#191970",Ct.MINT_CREAM="#F5FFFA",Ct.MISTY_ROSE="#FFE4E1",Ct.MOCCASIN="#FFE4B5",Ct.NAVAJOW_HITE="#FFDEAD",Ct.NAVY="#000080",Ct.OLDLACE="#FDF5E6",Ct.OLIVE="#808000",Ct.OLIVED_RAB="#688E23",Ct.ORANGE="#FFA500",Ct.ORANGE_RED="#FF4500",Ct.ORCHID="#DA70D6",Ct.PALE_GOLDEN_ROD="#EEE8AA",Ct.PALE_GREEN="#98FB98",Ct.PALE_TURQUOISE="#AFEEEE",Ct.PALE_VIOLET_RED="#D87093",Ct.PAPAYA_WHIP="#FFEFD5",Ct.PEACH_PUFF="#FFDAB9",Ct.PERU="#CD853F",Ct.PINK="#FFC0CB",Ct.PLUM="#DDA0DD",Ct.POWDER_BLUE="#B0E0E6",Ct.PURPLE="#800080",Ct.RED="#FF0000",Ct.ROSY_BROWN="#BC8F8F",Ct.ROYAL_BLUE="#4169E1",Ct.SADDLE_BROWN="#8B4513",Ct.SALMON="#FA8072",Ct.SANDY_BROWN="#F4A460",Ct.SEA_GREEN="#2E8B57",Ct.SEASHELL="#FFF5EE",Ct.SIENNA="#A0522D",Ct.SILVER="#C0C0C0",Ct.SKY_BLUE="#87CEEB",Ct.SLATE_BLUE="#6A5ACD",Ct.SLATE_GRAY="#708090",Ct.SNOW="#FFFAFA",Ct.SPRING_GREEN="#00FF7F",Ct.STEEL_BLUE="#4682B4",Ct.TAN="#D2B48C",Ct.TEAL="#008080",Ct.THISTLE="#D8BFD8",Ct.TOMATO="#FF6347",Ct.TURQUOISE="#40E0D0",Ct.VIOLET="#EE82EE",Ct.WHEAT="#F5DEB3",Ct.WHITE="#FFFFFF",Ct.WHITE_SMOKE="#F5F5F5",Ct.YELLOW="#FFFF00",Ct.YELLOW_GREEN="#9ACD32",Ct.create=function(t=0,e=0,n=0,i=1){return"rgb("+t+", "+e+", "+n+", "+i+")"},Ct.parseColour=function(t,e){return!0===e?"number"==typeof t?0|t:("string"==typeof t&&"#"===t[0]&&(t=t.slice(1)),window.parseInt(t,16)):("number"==typeof t&&(t="#"+("00000"+(0|t).toString(16)).substr(-6)),t)},Ct.toRgb=function(t){return"rgb("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Ct.of=function(t,e,n,i){return Uint8ClampedArray.of(t,e,n,i)},Ct.copy=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e};const Ft={TYPE:"undefined"!=typeof Float64Array?Float64Array:"undefined"!=typeof Float32Array?Float32Array:Array,create:function(){const t=arguments.length,e=new Ft.TYPE(t);for(let n=0;n<t;n++)e[n]=arguments[n];return e},createDimension:function(t,e=0){const n=new Ft.TYPE(t);for(let i=0;i<t;i++)n[i]=e;return n},copy:function(t,e){if(null==t)return null;null==e&&(e=new Ft.TYPE(t.length));const n=Math.min(t.length,e.length);for(let t=0;t<n;t+=1)e[index]=value;return e},equals:function(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n+=1)if(t[n]!==e[n])return!1;return!0}},Rt={create:function(t=0,e=0){return Ft.create(t,e)},copy:function(t,e=Rt.create(t[0],t[1])){return e[0]=t[0],e[1]=t[1],e},set:function(t,e=0,n=0){return t[0]=e,t[1]=n,t},equals:function(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;const n=St.equalish;return n(t[0],e[0])&&n(t[1],e[1])},zeroed:function(t){return t[0]=0,t[1]=0,t},negated:function(t){return t[0]=-t[0],t[1]=-t[1],t},negate:function(t,e=Rt.create()){return e[0]=-t[0],e[1]=-t[1],e},normalised:function(t,e=1){const n=t[0],i=t[1],o=e/Math.sqrt(n*n+i*i);return t[0]=n*o,t[1]=i*o,t},normalise:function(t,e=1,n=Rt.create()){const i=t[0],o=t[1],r=e/Math.sqrt(i*i+o*o);return n[0]=i*r,n[1]=o*r,n},scaled:function(t,e=1){return t[0]*=e,t[1]*=e,t},scale:function(t,e=1,n=Rt.create()){return n[0]=t[0]*e,n[1]=t[1]*e,n},added:function(t,e){return t[0]+=e[0],t[1]+=e[1],t},add:function(t,e,n=Rt.create()){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n},subtracted:function(t,e){return t[0]-=e[0],t[1]-=e[1],t},subtract:function(t,e,n=Rt.create()){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n},length:function(t){const e=t[0],n=t[1];return Math.sqrt(e*e+n*n)},norm:function(t){const e=t[0],n=t[1];return e*e+n*n},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]},cross:function(t,e){return t[0]*e[1]-t[1]*e[0]},scalarCross:function(t,e=1,n=Rt.create()){return n[0]=e*t[1],n[1]=-e*t[0],n},crossScalar:function(t,e=1,n=Rt.create()){return n[0]=-e*t[1],n[1]=e*t[0],n},project:function(t,e,n,i){return t[0]=e[0]+St.fasterCos(n)*i,t[1]=e[1]+St.fasterSin(n)*i,t},distance:function(t,e){var n=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(n*n+i*i)},antiClockwisePerpendicular:function(t,e=Rt.create()){return e[0]=-t[1],e[1]=t[0],e},clockwisePerpendicular:function(t,e=Rt.create()){return e[0]=t[1],e[1]=-t[0],e},antiClockwiseNormal:function(t,e=Rt.create()){const n=-t[1],i=t[0],o=n*n+i*i,r=1/Math.sqrt(o);return e[0]=n*r,e[1]=i*r,e},clockwiseNormal:function(t,e=Rt.create()){const n=t[0],i=-t[1],o=n*n+i*i,r=Math.sqrt(o);return e[0]=n*r,e[1]=i*r,e}},St={EPSILON:1e-6,TAU:2*Math.PI,THREE_QUARTER_TAU:3*Math.PI/2,HALF_TAU:Math.PI,THIRD_TAU:2*Math.PI/3,QUARTER_TAU:Math.PI/2,SIXTH_TAU:2*Math.PI/6,CIRCLE:360,THREE_QUARTER_CIRCLE:270,HALF_CIRCLE:180,THIRD_CIRCLE:120,QUARTER_CIRCLE:90,SIXTH_CIRCLE:60,TO_DEGREES:180/Math.PI,TO_RADIANS:Math.PI/180,square:function(t){return t*t},cube:function(t){return t*t*t},generateTable:function(t,e,n,i){var o,r=new Ft.TYPE((e-t)/n);for(o=t;o<e;o+=n)r[o]=i(o);return r},rotateXPosition:function(t,e,n){return t+Math.cos(e)*n},rotateYPosition:function(t,e,n){return t+Math.sin(e)*n},angleOf:function(t,e,n,i){var o=n-t,r=i-e;return Math.atan2(r,o)},equalish:function(t,e,n){return Math.abs(t-e)<=(n||this.EPSILON)*Math.max(1,Math.abs(t),Math.abs(e))},random:function(t){return Math.random()*(t||0)},randomIntBetween:function(t,e){return Math.floor((e-t)*Math.random())+t},randomInt:function(t){return Math.floor(t*Math.random())},randomElement:function(t){return t[randomInt(t.length)-1]},scatter:function(t,e){var n=this.random(e),i=this.random(this.TAU),o=Math.sin(i),r=Math.cos(i);return Rt.translate(Rt.copy(t),r*n,o*n)},distance:function(t,e,n,i){var o=n-t,r=i-e;return Math.sqrt(o*o+r*r)},pythagoreanSolve:function(t,e){return Math.sqrt(t*t+e*e)},intersectLines:function(t,e,n){var i=e.pointB[0]-e.pointA[0],o=e.pointB[1]-e.pointA[1],r=n.pointB[0]-n.pointA[0],s=n.pointB[1]-n.pointA[1],a=r*o-s*i,c=r*(n.pointA[1]-e.pointA[1])-s*(n.pointA[0]-e.pointA[0]),l=i*(n.pointA[1]-e.pointA[1])-o*(n.pointA[0]-e.pointA[0]),u=-1,h=-1;if(a>0){if(h=l/a,(u=c/a)<0||u>1||h<0||h>1)return null;Rt.position(t,e.pointA[0]+i*u,e.pointA[1]+o*u)}return t},intersectRayAndSphere:function(t,e,n,i,o=Tt.create()){const r=Tt.subtract(n,t,o),s=Tt.dot(r,e);if(s<0)return null;const a=Tt.dot(r,r)-s*s;if(a>i)return null;const c=Math.sqrt(i-a);let l=s-c,u=s+c;if(l>u){const t=l;l=u,u=t}return l<0&&(l=u,l<0)?null:l},intersectRayAndPlane:function(t,e,n,i){const o=Tt.dot(i,e);if(o>1e-6){const e=Tt.subtract(n,t);return Tt.dot(e,i)/o}return null},intersectRayAndDisk:function(t,e,n,i,o){let r=St.intersectRayAndPlane(t,e,n,i);if(null!=r){const i=Tt.add(t,Tt.scale(e,r)),s=Tt.subtract(i,n);return Tt.dot(s,s)<=o}return null},intersectRayAndBox:function(t,e,n,i){let o=(n[0]-t[0])/e[0],r=(i[0]-t[0])/e[0],s=null;o>r&&(s=o,o=r,r=s);let a=(n[1]-t[1])/e[1],c=(i[1]-t[1])/e[1];if(a>c&&(s=a,a=c,c=s),o>c||a>r)return null;a>o&&(o=a),c<r&&(r=c);let l=(n[2]-t[2])/e[2],u=(i[2]-t[2])/e[2];return l>u&&(s=l,l=u,u=s),o>u||l>r?null:(l>o&&(o=l),u<r&&(r=u),{tmin:o,tmax:r})},lerp:function(t,e,n){return(1-n)*t+n*e},lerpPoint2D:function(t,e,n,i){var o=St.lerp;return t[0]=o(e[0],n[0],i),t[1]=o(e[1],n[1],i),t},lerpVec2ByDistance:function(t,e,n,i){var o=i/Rt.distance(e,n);return St.lerpPoint2D(t,e,n,o)},perpendicularByDistance:function(t,e,n,i){var o,r,s;return o=n[0]-e[0],r=n[1]-e[1],s=Rt.create(n[0]-r,n[1]+o),St.lerpVec2ByDistance(t,n,s,i)},perpendicularBasePoint:function(t,e,n){var i,o,r;return i=e.pointB[0]-e.pointA[0],o=e.pointB[1]-e.pointA[1],r=(i*(n[0]-e.pointA[0])+o*(n[1]-e.pointA[1]))/(i*i+o*o),St.lerpPoint2D(t,e.pointA(),e.pointB(),r)},parallelPoint:function(t,e){var n,i;return n=t.pointB[0]-t.pointA[0],i=t.pointB[1]-t.pointA[1],new Rt(e[0]+n,e[1]+i)},round:function(t,e){return Math.round(t*e)/e},fastFloor:function(t){return.5+t|0},centroid:function(t,e){return t=t||Rt.create(0,0),e.length>3?this.polygonCentroid(t,e):3===e.length?this.triangleCentroid(e[0],e[1],e[2],t):2===e.length?this.lerpPoint2D(t,e[0],e[1],.5):1===e.length?Rt.copy(t,e[0]):t},triangleCentroid:function(t,e,n,i=Tt.create()){return i[0]=(t[0]+e[0]+n[0])/3,i[1]=(t[1]+e[1]+n[1])/3,i},triangleNormal:function(t,e,n,i=Tt.create()){const o=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],a=n[0]-t[0],c=n[1]-t[1],l=n[2]-t[2],u=-s*c+r*l,h=s*a-o*l,d=-r*a+o*c,f=1/Math.sqrt(u*u+h*h+d*d);return i[0]=u*f,i[1]=h*f,i[2]=d*f,i},polygonCentroid:function(t,e){var n,i,o=e.length,r=0,s=0,a=0,c=0,l=0,u=0,h=null;for(i=0;i<o;i+=1)s=(h=e[i])[0],a=h[1],c=(h=e[(i+1)%o])[0],r+=u=s*(l=h[1])-c*a,t[0]+=(s+c)*u,t[1]+=(a+l)*u;return n=6*(r*=.5),t[0]/=n,t[1]/=n,t},isPolygonConvex:function(t){},polygonWindingSum:function(t){var e,n,i,o,r=0,s=t.length;for(e=0;e<s;e+=1)n=(e+1)%s,i=t[e],r+=((o=t[n])[0]-i[0])*(i[1]+o[1]);return r},edgeFunction:function(t,e,n){return(n[0]-t[0])*(e[1]-t[1])-(n[1]-t[1])*(e[0]-t[0])},isPointInsidePolygon:function(t,e){const n=e.length;for(let i=0;i<n;i++)if(St.edgeFunction(e[i],e[(i+1)%n],t)<0)return!1;return!0},isPointOutsidePolygon:function(t,e){const n=e.length;for(let i=0;i<n;i++)if(St.edgeFunction(e[i],e[(i+1)%n],t)>=0)return!1;return!0},isPointInsideTriangle:function(t,e,n,i){const o=St.edgeFunction(e,n,i),r=St.edgeFunction(n,t,i),s=St.edgeFunction(t,e,i);return o>=0&&r>=0&&s>=0},minMaxTriangle:function(t,e,n,i,o){let r=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,a=-Number.MAX_SAFE_INTEGER,c=-Number.MAX_SAFE_INTEGER;const l=t[0],u=t[1],h=e[0],d=e[1],f=n[0],p=n[1];l<r&&(r=l),u<s&&(s=u),l>a&&(a=l),u>c&&(c=u),h<r&&(r=h),d<s&&(s=d),h>a&&(a=h),d>c&&(c=d),f<r&&(r=f),p<s&&(s=p),f>a&&(a=f),p>c&&(c=p),i[0]=r,i[1]=s,o[0]=a,o[1]=c},pointToBarycentricCoordinates:function(t,e,n,i){const o=St.edgeFunction(t,e,n),r=St.edgeFunction(e,n,i),s=St.edgeFunction(n,t,i),a=1-r-s;return Tt.create(r/o,s/o,a/o)},circleTopPoint:function(t,e){return Rt.create(t[0],t[1]-e)},circleBottomPoint:function(t,e){return Rt.create(t[0],t[1]+e)},circleLeftPoint:function(t,e){return Rt.create(t[0]-e,t[1])},circleRightPoint:function(t,e){return Rt.create(t[0]+e,t[1])},InterpolationFunction:function(t){var e=function(t,e){return t[0]-e[0]};this.points=t,this.rangeMin=min(t,e),this.rangeMax=max(t,e),this.point=function(t){var e,n,i,o,r,s=St.lerp(this.rangeMin[0],this.rangeMax[0],t);for(e=0;e<this.points.length;e+=1){if(s===(n=this.points[e])[0])return n;if(!(s>n[0]))return r=(s-i[0])/(n[0]-i[0]),o=St.lerp(i[1],n[1],r),Rt.create(s,o);i=this.points[e]}}},Radians:function(t){var e=t;this.rotateRadians=function(t){e=St.addRadians(e,t)},this.rotateDegrees=function(t){e=St.addRadians(e,St.toRadians(t))},this.radians=function(){return e},this.degrees=function(){return St.toDegrees(e)},this.toDegrees=function(){return new St.Degrees(St.toDegrees(e))}},Degrees:function(t){var e=t;this.rotateRadians=function(t){e=St.addDegrees(e,St.toDegrees(t))},this.rotateDegrees=function(t){e=St.addDegrees(e,t)},this.radians=function(){return St.toRadians(e)},this.degrees=function(){return e},this.toRadians=function(){return new St.Radians(St.toRadians(e))}},toDegrees:function(t){return t*St.TO_DEGREES},toRadians:function(t){return t*St.TO_RADIANS},radians:function(t){var e=t,n=this.TAU;return t>n?e=t%n:t<0&&(e=t%n+n),e},degrees:function(t){var e=t,n=this.CIRCLE;return t>n?e=t%n:t<0&&(e=t%n+n),e},addRadians:function(t,e){return St.radians(t+e)},addDegrees:function(t,e){return St.degrees(t+e)},biasGreaterThan:function(t,e){return t>=.95*e+.01*t},biasLessThan:function(t,e){return t<=.95*e+.01*t}};St.sinTable=St.generateTable(0,360,1,(function(t){return Math.sin(St.toRadians(t))})),St.fastSin=function(t){var e=St.degrees(t);return(0|Number(e))===e?St.sinTable[e]:Math.sin(t)},St.fasterSin=function(t){var e=St.fastFloor(t);return St.sinTable[e]},St.cosTable=St.generateTable(0,360,1,(function(t){return Math.cos(St.toRadians(t))})),St.fastCos=function(t){var e=St.degrees(t);return(0|Number(e))===e?St.cosTable[e]:Math.cos(t)},St.fasterCos=function(t){var e=St.fastFloor(t);return St.cosTable[e]},St.clamp=function(t,e,n){return Math.max(t,Math.min(e,n))},St.Line=function(){var t=new Args(arguments);this._pointA=null,this._pointB=null,t.matches(Number,Number,Number,Number)?(this._pointA=Rt.create(t.get(0),t.get(1)),this._pointB=Rt.create(t.get(2),t.get(3))):t.matches(Rt,Rt)?(this._pointA=t.get(0),this._pointB=t.get(1)):t.matches(St.Line)&&(this._pointA=t.get(0).pointA(),this._pointB=t.get(0).pointA())},St.Line.prototype.pointA=function(t){return s(t)?(this._pointA=t,this):this._pointA},St.Line.prototype.pointB=function(t){return s(t)?(this._pointB=t,this):this._pointB},St.Line.prototype.dx=function(){return this._pointB.x-this._pointA.x},St.Line.prototype.dy=function(){return this._pointB.y-this._pointA.y},St.Line.prototype.gradient=function(){return this.dy()/this.dx()},St.Line.prototype.lineLength=function(){return Rt.distance(this._pointA,this._pointB)},St.Line.prototype.angle=function(){return Math.atan2(this.dy(),this.dx())},St.Line.prototype.copy=function(){return new St.Line(this._pointA,this._pointB)},St.Circle=function(t,e){this.centre=t,this.radius=e},St.Circle.prototype.clone=function(){return new St.Circle(this.centre,this.radius)},St.Circle.prototype.copy=function(t){return this.centre=t.centre,this.radius=t.radius,this},St.Circle.prototype.diameter=function(){return 2*this.radius},St.Circle.prototype.perimeter=function(){return St.TAU*this.radius},St.Circle.prototype.area=function(){return St.HALF_TAU*this.radius*this.radius},St.Circle.prototype.pointAt=function(t){var e=St.rotateXPosition(0,t,this.radius),n=St.rotateYPosition(0,t,this.radius);return new Rt.create(e,n)},St.Rectangle=function(t,e){this.min,this.max,this.width,this.height,this.init(t,e)},St.Rectangle.prototype.init=function(t,e){var n=e[0]-t[0],i=e[1]-t[1];n<0&&i<0?(this.min=e,this.max=t,this.width=-n,this.height=-i):n<0&&i>0?(this.min=Rt.create(e[0],t[1]),this.max=Rt.create(t[0],e[1]),this.width=-n,this.height=i):n>0&&i<0?(this.min=Rt.create(t[0],e[1]),this.max=Rt.create(e[0],t[1]),this.width=n,this.height=-i):(this.min=t,this.max=e,this.width=n,this.height=i)},St.Rectangle.prototype.area=function(){return this.width*this.height};const Tt={create:function(t=0,e=0,n=0){return Ft.create(t,e,n)},createDirection:function(t,e,n=Tt.create()){return Tt.normalised(Tt.subtract(e,t,n))},copy:function(t,e=Tt.create(t[0],t[1],t[2])){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set:function(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t},equals:function(t,e,n){if(e===n)return!0;if(null==e||null==n)return!1;if(e.length!==n.length)return!1;const i=St.equalish;return i(e[0],n[0])&&i(e[1],n[1])&&i(e[2],n[2])},zeroed:function(t){return t[0]=0,t[1]=0,t[2]=0,t},negated:function(t){return t[0]=-t[0],t[1]=-t[1],t[2]=-t[2],t},negate:function(t,e=Tt.create()){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},normalised:function(t,e=1){const n=t[0],i=t[1],o=t[2],r=e/Math.sqrt(n*n+i*i+o*o);return t[0]=n*r,t[1]=i*r,t[2]=o*r,t},normalise:function(t,e=1,n=Tt.create()){const i=t[0],o=t[1],r=t[2],s=e/Math.sqrt(i*i+o*o+r*r);return n[0]=i*s,n[1]=o*s,n[2]=r*s,n},added:function(t,e){return t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t},add:function(t,e,n=Tt.create()){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n},subtracted:function(t,e){return t[0]-=e[0],t[1]-=e[1],t[2]-=e[2],t},subtract:function(t,e,n=Tt.create()){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n},scaled:function(t,e){return t[0]*=e,t[1]*=e,t[2]*=e,t},scale:function(t,e=1,n=Tt.create()){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},cross:function(t,e,n=Tt.create()){const i=t[0],o=t[1],r=t[2],s=e[0],a=e[1],c=e[2];return n[0]=-r*a+o*c,n[1]=r*s-i*c,n[2]=-o*s+i*a,n},length:function(t){const e=t[0],n=t[1],i=t[2];return Math.sqrt(e*e+n*n+i*i)},norm:function(t){const e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}};Tt.ORIGIN=Tt.create(0,0,0),Tt.X_AXIS=Tt.create(1,0,0),Tt.Y_AXIS=Tt.create(0,1,0),Tt.Z_AXIS=Tt.create(0,0,1);const kt={create:function(t=1,e=0,n=0,i=0,o=0,r=1,s=0,a=0,c=0,l=0,u=1,h=0,d=0,f=0,p=0,m=1){return[Ft.create(t,e,n,i),Ft.create(o,r,s,a),Ft.create(c,l,u,h),Ft.create(d,f,p,m)]},identity:function(){return[Ft.create(1,0,0,0),Ft.create(0,1,0,0),Ft.create(0,0,1,0),Ft.create(0,0,0,1)]},set:function(t,e=1,n=0,i=0,o=0,r=0,s=1,a=0,c=0,l=0,u=0,h=1,d=0,f=0,p=0,m=0,g=1){return t[0][0]=e,t[0][1]=n,t[0][2]=i,t[0][3]=o,t[1][0]=r,t[1][1]=s,t[1][2]=a,t[1][3]=c,t[2][0]=l,t[2][1]=u,t[2][2]=h,t[2][3]=d,t[3][0]=f,t[3][1]=p,t[3][2]=m,t[3][3]=g,t},copy:function(t){return kt.create(t[0][0],t[0][1],t[0][2],t[0][3],t[1][0],t[1][1],t[1][2],t[1][3],t[2][0],t[2][1],t[2][2],t[2][3],t[3][0],t[3][1],t[3][2],t[3][3])},row:function(t,e){const n=t[e];return[n[0],n[1],n[2],n[3]]},column:function(t,e){return[t[0][e],t[1][e],t[2][e],t[3][e]]},multiply:function(t,e,n=kt.create()){for(let i=0;i<4;++i)for(let o=0;o<4;++o)n[i][o]=t[i][0]*e[0][o]+t[i][1]*e[1][o]+t[i][2]*e[2][o]+t[i][3]*e[3][o];return n},transpose:function(t,e=kt.create()){for(let n=0;n<4;++n)for(let i=0;i<4;++i)e[n][i]=t[i][n];return e},multiplyVector:function(t,e,n=Tt.create()){const i=t[0]*e[0][0]+t[1]*e[1][0]+t[2]*e[2][0]+e[3][0],o=t[0]*e[0][1]+t[1]*e[1][1]+t[2]*e[2][1]+e[3][1],r=t[0]*e[0][2]+t[1]*e[1][2]+t[2]*e[2][2]+e[3][2],s=t[0]*e[0][3]+t[1]*e[1][3]+t[2]*e[2][3]+e[3][3];return 1!=s?(n[0]=i/s,n[1]=o/s,n[2]=r/s):(n[0]=i,n[1]=o,n[2]=r),n},multiplyDirection:function(t,e,n=Tt.create()){return n[0]=t[0]*e[0][0]+t[1]*e[1][0]+t[2]*e[2][0],n[1]=t[0]*e[0][1]+t[1]*e[1][1]+t[2]*e[2][1],n[2]=t[0]*e[0][2]+t[1]*e[1][2]+t[2]*e[2][2],n},multiplyHomogeneousVector:function(t,e,n=Ft.create(0,0,0,1)){const i=t[0]*e[0][0]+t[1]*e[1][0]+t[2]*e[2][0]+e[3][0],o=t[0]*e[0][1]+t[1]*e[1][1]+t[2]*e[2][1]+e[3][1],r=t[0]*e[0][2]+t[1]*e[1][2]+t[2]*e[2][2]+e[3][2],s=t[0]*e[0][3]+t[1]*e[1][3]+t[2]*e[2][3]+e[3][3];return n[0]=i,n[1]=o,n[2]=r,n[3]=s,n},inverse:function(t,e){let n,i,o;const r=kt.copy(t);let s=null;for(s=e?kt.set(e):kt.identity(),n=0;n<3;n++){let t=n,e=r[n][n];for(e<0&&(e*=-1),i=n+1;i<4;i++){let o=r[i][n];o<0&&(o*=-1),o>e&&(t=i,e=o)}if(0==e)return kt.create();if(t!=n)for(i=0;i<4;i++){let e;e=r[n][i],r[n][i]=r[t][i],r[t][i]=e,e=s[n][i],s[n][i]=s[t][i],s[t][i]=e}for(i=n+1;i<4;i++){let t=r[i][n]/r[n][n];for(o=0;o<4;o++)r[i][o]=r[i][o]-t*r[n][o],s[i][o]=s[i][o]-t*s[n][o]}}for(n=3;n>=0;--n){let t=r[n][n];if(0==t)return kt.create();for(i=0;i<4;i++)r[n][i]=r[n][i]/t,s[n][i]=s[n][i]/t;for(i=0;i<n;i++)for(t=r[i][n],o=0;o<4;o++)r[i][o]=r[i][o]-t*r[n][o],s[i][o]=s[i][o]-t*s[n][o]}return s}},Ot=function(t,e){let n=null;n=e||kt.identity();const i=Math.cos(t),o=Math.sin(t);return n[0][0]=1,n[0][1]=0,n[0][2]=0,n[0][3]=0,n[1][0]=0,n[1][1]=i,n[1][2]=o,n[1][3]=0,n[2][0]=0,n[2][1]=-o,n[2][2]=i,n[2][3]=0,n[3][0]=0,n[3][1]=0,n[3][2]=0,n[3][3]=1,n},Lt=function(t,e){let n=null;n=e||kt.identity();const i=Math.cos(t),o=Math.sin(t);return n[0][0]=i,n[0][1]=0,n[0][2]=-o,n[0][3]=0,n[1][0]=0,n[1][1]=1,n[1][2]=0,n[1][3]=0,n[2][0]=o,n[2][1]=0,n[2][2]=i,n[2][3]=0,n[3][0]=0,n[3][1]=0,n[3][2]=0,n[3][3]=1,n},Nt=function(t,e){let n=null;n=e||kt.identity();const i=Math.cos(t),o=Math.sin(t);return n[0][0]=i,n[0][1]=o,n[0][2]=0,n[0][3]=0,n[1][0]=-o,n[1][1]=i,n[1][2]=0,n[1][3]=0,n[2][0]=0,n[2][1]=0,n[2][2]=1,n[2][3]=0,n[3][0]=0,n[3][1]=0,n[3][2]=0,n[3][3]=1,n},Dt=function(t){this.init=function(t){this.settings=Object.assign({canvasWidth:1,canvasHeight:1,imageWidth:512,imageHeight:512,fNear:1,fFar:10,fov:90},t||{}),this.cameraToWorld=kt.create(),this.worldToCamera=kt.inverse(this.cameraToWorld),this.transformNormals=kt.transpose(this.worldToCamera),this.canvasWidth=this.settings.canvasWidth,this.canvasHeight=this.settings.canvasHeight,this.imageWidth=this.settings.imageWidth,this.imageHeight=this.settings.imageHeight,this.aspectRatio=this.imageHeight/this.imageWidth,this.fNear=this.settings.fNear,this.fFar=this.settings.fFar,this.fov=this.settings.fov*(Math.PI/180),this.projectionTransform=this.createPerspectiveTransform(this.fNear,this.fFar,this.fov),this.yaw=0,this.pitch=0,this.roll=0,this.p0=Rt.create(),this.vCamera=Tt.create(),this.v1=Tt.create(),this.v2=Tt.create(),this.v3=Tt.create(),this.v4=Tt.create(),this.v5=Tt.create(),this.v6=Tt.create(),this.v7=Tt.create(),this.v8=Tt.create(),this.v9=Tt.create(),this.v10=Tt.create(),this.v12=Tt.create(),this.v13=Tt.create(),this.v14=Tt.create(),this.v15=Tt.create(),this.v16=Tt.create(),this.v17=Tt.create(),this.m0=kt.create(),this.m1=kt.create(),this.m2=kt.create(),this.m3=kt.create()},Dt.prototype.createPerspectiveTransform=function(t,e,n){const i=1/Math.tan(.5*n),o=e-t,r=e/o,s=e*t*-1/o;return kt.create(i,0,0,0,0,i,0,0,0,0,r,-1,0,0,s,0)},Dt.prototype.createOrthographicTransform=function(t,e,n,i,o,r){const s=2/(e-t),a=2/(n-i),c=-2/(r-o),l=-(e+t)/(e-t),u=-(n+i)/(n-i),h=-(r+o)/(r-o);return kt.create(s,0,0,0,0,a,0,0,0,0,c,0,l,u,h,1)},Dt.prototype.applyProjectionAndConvertToNDC=function(t,e){const n=kt.multiplyVector(t,this.worldToCamera,this.v0),i=kt.multiplyVector(n,this.projectionTransform,this.v1),o=this.p0;o[0]=(i[0]+.5*this.canvasWidth)/this.canvasWidth,o[1]=(i[1]/this.aspectRatio+.5*this.canvasHeight)/this.canvasHeight,e[0]=.5+o[0]*this.imageWidth|0,e[1]=.5+(1-o[1])*this.imageHeight|0,e[2]=n[2]},Dt.prototype.toCameraSpace=function(t,e){return kt.multiplyVector(t,this.worldToCamera,e)},Dt.prototype.applyProjection=function(t,e){return kt.multiplyHomogeneousVector(t,this.projectionTransform,e)},Dt.prototype.toNdc=function(t,e){const n=this.canvasWidth,i=this.canvasHeight;return e[0]=(t[0]+.5*n)/n,e[1]=(t[1]/this.aspectRatio+.5*i)/i,e},Dt.prototype.toRaster=function(t,e){return e[0]=t[0]*this.imageWidth|0,e[1]=(1-t[1])*this.imageHeight|0,e},Dt.prototype.update=function(){const t=Ot(this.pitch,this.m1),e=Lt(this.yaw,this.m2),n=Nt(this.roll,this.m3),i=kt.multiply(t,e,this.m0),o=Tt.set(this.v8,0,0,-1),r=kt.multiplyVector(o,i,this.v2);Tt.add(this.position,r,o),this.lookAt(this.position,o);const s=this.cameraToWorld;this.cameraToWorld=kt.multiply(n,s,this.worldToCamera),this.worldToCamera=kt.inverse(this.cameraToWorld,s)},Dt.prototype.lookAt=function(t,e){const n=Tt.normalised(Tt.subtract(t,e,this.v6)),i=Tt.set(this.v9,0,1,0);Tt.equals(n,i)?Tt.set(i,0,0,-1):Tt.cross(Tt.normalised(Tt.set(this.v10,0,1,0)),n,i);const o=Tt.cross(n,i,this.v2Raster),r=kt.create();r[0][0]=i[0],r[0][1]=i[1],r[0][2]=i[2],r[1][0]=o[0],r[1][1]=o[1],r[1][2]=o[2],r[2][0]=n[0],r[2][1]=n[1],r[2][2]=n[2],r[3][0]=t[0],r[3][1]=t[1],r[3][2]=t[2],this.position=Tt.copy(t),this.forward=n,this.right=i,this.up=o,this.cameraToWorld=r,kt.inverse(this.cameraToWorld,this.worldToCamera),kt.transpose(this.worldToCamera,this.transformNormals)},Dt.prototype.triangleNormal=function(t,e,n){const i=Tt.subtract(e,t,this.v3),o=Tt.subtract(n,t,this.v4);return Tt.normalised(Tt.cross(i,o,this.v5))},Dt.prototype.direction=function(t,e){return Tt.normalised(Tt.subtract(e,t,this.v7))},Dt.prototype.moveForward=function(t){Tt.added(this.position,Tt.normalise(this.forward,-t,this.v12))},Dt.prototype.moveBackward=function(t){Tt.added(this.position,Tt.normalise(this.forward,t,this.v13))},Dt.prototype.moveRight=function(t){Tt.added(this.position,Tt.normalise(this.right,t,this.v14))},Dt.prototype.moveLeft=function(t){Tt.added(this.position,Tt.normalise(this.right,-t,this.v15))},Dt.prototype.moveUp=function(t){Tt.added(this.position,Tt.normalise(this.up,-t,this.v16))},Dt.prototype.moveDown=function(t){Tt.added(this.position,Tt.normalise(this.up,t,this.v17))},Dt.prototype.yawRight=function(t){this.yaw-=t},Dt.prototype.yawLeft=function(t){this.yaw+=t},Dt.prototype.pitchUp=function(t){this.pitch+=t},Dt.prototype.pitchDown=function(t){this.pitch-=t},Dt.prototype.rollClockwise=function(t){this.roll-=t},Dt.prototype.rollCounterClockwise=function(t){this.roll+=t},this.init(t)},It=function(t){this.settings=Object.assign({canvas:"canvas",width:640,height:480,pixelWidth:1,pixelheight:1,alpha:!0,antialias:!1,depth:!0},t||{}),this.canvasElement=document.getElementById(this.settings.canvas),this.size(this.settings.width,this.settings.height),this.ctx=this.canvasElement.getContext("2d",{alpha:this.settings.alpha,antialias:this.settings.antialias,depth:this.settings.depth}),this.pixelWidth=Math.round(this.settings.pixelWidth),this.pixelHeight=Math.round(this.settings.pixelHeight),this.imageData=this.ctx.getImageData(0,0,this.settings.width,this.settings.height),this.imageDataData=this.imageData.data,this.buffer=new ArrayBuffer(this.imageData.data.length),this.buffer8=new Uint8ClampedArray(this.buffer),this.buffer32=new Uint32Array(this.buffer)};It.prototype.size=function(t=640,e=480){this.width=t,this.height=e,this.canvasElement.setAttribute("width",this.width),this.canvasElement.setAttribute("height",this.height)},It.prototype.clear=function(){for(let t=0;t<this.height;t++){const e=t*this.width;for(let t=0;t<this.width;t++)this.buffer32[e+t]=0}this.update()},It.prototype.setPixel=function(t,e,n){const i=this.width,o=this.pixelWidth,r=this.pixelHeight,s=n[3]<<24|n[2]<<16|n[1]<<8|n[0];for(let n=0;n<r;n++)for(let a=0;a<o;a++){const c=t*o+a+(e*r+n)*i;this.buffer32[c]=s}},It.prototype.update=function(){this.imageDataData.set(this.buffer8),this.ctx.putImageData(this.imageData,0,0)};const Bt=function(t){const e=Object.assign({ambient:Tt.create(1,1,1),diffuse:Tt.create(1,1,1),specular:Tt.create(1,1,1),shininess:2,alpha:1,pattern:function(t){return 1}},t||{});this.ambient=e.ambient,this.diffuse=e.diffuse,this.specular=e.specular,this.shininess=e.shininess,this.alpha=e.alpha,this.pattern=e.pattern,this.shadow=!0,this.texture=e.texture},Mt=function(){this.position=Tt.create(),this.rotation=Tt.create(),this.localToWorld=kt.create(),this.worldToLocal=kt.inverse(this.localToWorld),this.transformNormals=kt.transpose(this.worldToLocal),this.material=new Bt,this.v0=Tt.create(),this.v1=Tt.create(),this.v2=Tt.create(),this.v3=Tt.create(),this.m0=kt.create(),this.m1=kt.create(),this.m2=kt.create(),this.m3=kt.create(),this.m4=kt.create(),this.m5=kt.create(),this.m6=kt.create()};Mt.prototype.positionAndOrient=function(t,e=Tt.create(0,0,-1)){const n=Tt.normalise(e,1,this.v0),i=Tt.set(this.v1,0,1,0);Tt.equals(n,i)?Tt.set(i,0,0,-1):Tt.cross(Tt.normalised(Tt.set(this.v2,0,1,0)),n,i);const o=Tt.cross(n,i,this.v3),r=kt.create();r[0][0]=i[0],r[0][1]=i[1],r[0][2]=i[2],r[1][0]=o[0],r[1][1]=o[1],r[1][2]=o[2],r[2][0]=n[0],r[2][1]=n[1],r[2][2]=n[2],r[3][0]=t[0],r[3][1]=t[1],r[3][2]=t[2],this.position=Tt.copy(t),this.forward=n,this.right=i,this.up=o,this.localToWorld=r,kt.inverse(this.localToWorld,this.worldToLocal),kt.transpose(this.worldToLocal,this.transformNormals)},Mt.prototype.update=function(){const t=Ot(this.rotation[0],this.m0),e=Lt(this.rotation[1],this.m1),n=Nt(this.rotation[2],this.m2),i=function(t,e){let n=null;return n=e||kt.identity(),n[0][0]=1,n[0][1]=0,n[0][2]=0,n[0][3]=0,n[1][0]=0,n[1][1]=1,n[1][2]=0,n[1][3]=0,n[2][0]=0,n[2][1]=0,n[2][2]=1,n[2][3]=0,n[3][0]=t[0],n[3][1]=t[1],n[3][2]=t[2],n[3][3]=1,e}(this.position,this.m3),o=kt.set(this.localToWorld);kt.multiply(o,n,this.m4),kt.multiply(this.m4,e,this.m5),kt.multiply(this.m5,t,this.m6),kt.multiply(this.m6,i,this.localToWorld),kt.inverse(this.localToWorld,this.worldToLocal),kt.transpose(this.worldToLocal,this.transformNormals)},Mt.prototype.intersect=function(){return null};const Pt=function(t){const e=Object.assign({red:1,green:1,blue:1,intensity:1},t||{});this.red=e.red,this.green=e.green,this.blue=e.blue,this.intensity=e.intensity};Pt.prototype.getIlluminationAt=function(t){return{direction:null,distance:null,intensity:this.intensity}};const Ht=function(t){const e=Object.assign({red:1,green:1,blue:1,intensity:1,direction:Tt.create(0,0,1)},t||{});this.red=e.red,this.green=e.green,this.blue=e.blue,this.intensity=e.intensity,this.direction=e.direction};Ht.prototype.getIlluminationAt=function(t){return{direction:this.direction,distance:Number.MAX_SAFE_INTEGER,intensity:this.intensity}};const Gt=function(t){const e=Object.assign({red:1,green:1,blue:1,intensity:1,position:Tt.create(0,0,0)},t||{});this.red=e.red,this.green=e.green,this.blue=e.blue,this.intensity=e.intensity,this.object=new Mt,this.object.positionAndOrient(t.position),this.direction=Tt.create()};Gt.prototype.getIlluminationAt=function(t){Tt.subtract(this.object.position,t,this.direction);const e=Tt.norm(this.direction);return Tt.normalised(this.direction),{direction:this.direction,distance:Math.sqrt(e),intensity:this.intensity/(4*Math.PI*e)}};const Ut=function(){};Ut.TYPE={AMBIENT:Pt,DISTANT:Ht,POINT:Gt},Ut.of=function(t,e){const n=new t(e);return n.type=t,n},Ut.ambient=function(t){return Ut.of(Ut.TYPE.AMBIENT,t)},Ut.distant=function(t){return Ut.of(Ut.TYPE.DISTANT,t)},Ut.point=function(t){return Ut.of(Ut.TYPE.POINT,t)};const jt=function(t){this.width=t.width,this.height=t.height,this.world=t.world,this.shadowBias=41e-5,this.v0=Tt.create(),this.v1=Tt.create(),this.v2=Tt.create(),this.v3=Tt.create(),this.v4=Tt.create(),this.v5=Tt.create(),this.v6=Tt.create(),this.v7=Tt.create(),this.v8=Tt.create(),this.v9=Tt.create(),this.pixel=Uint8ClampedArray.of(0,0,0,0)};jt.prototype.shade=function(t,e,n){const i=this.world;let o=0,r=0,s=0;const a=e.st,c=e.uv;let l=e.normal;c&&e.vn0&&e.vn1&&e.vn2&&(l=Tt.normalised(Tt.add(Tt.add(Tt.scale(e.vn2,c[2],this.v2),Tt.scale(e.vn0,c[0],this.v0),this.v5),Tt.scale(e.vn1,c[1],this.v1),this.v6)));const u=e.material;let h=1;u.pattern&&a&&(h=u.pattern(a));const d=i.lights,f=d.length;for(let e=0;e<f;e++){const i=d[e];if(i.type==Ut.TYPE.AMBIENT)o+=u.ambient[0]*i.red*i.intensity,r+=u.ambient[1]*i.green*i.intensity,s+=u.ambient[2]*i.blue*i.intensity;else{const e=i.getIlluminationAt(t),c=e.intensity,h=e.direction;e.distance;let d=!1;if(d=!0,d){const t=i.red,e=i.green,d=i.blue;let f=null,p=null,m=null;if(a&&u.texture){const t=u.texture,e=t.pixels,n=t.width,i=t.height,o=4*((a[0]*n+.5|0)+(i-a[1]*i+.5|0)*n);f=e[o]/255,p=e[o+1]/255,m=e[o+2]/255}else{const t=u.diffuse;f=t[0],p=t[1],m=t[2]}const g=Math.max(0,Tt.dot(h,l));if(o+=f*t*g*c,r+=p*e*g*c,s+=m*d*g*c,n){const i=this.reflect(h,l),a=Math.max(0,Tt.dot(i,n)),f=Math.pow(a,u.shininess);o+=u.specular[0]*t*f*c,r+=u.specular[1]*e*f*c,s+=u.specular[2]*d*f*c}}}}const p=this.pixel;return p[0]=o/f*255*h,p[1]=r/f*255*h,p[2]=s/f*255*h,p[3]=255,p},jt.prototype.reflect=function(t,e){return Tt.subtract(Tt.scale(e,2*Tt.dot(t,e),this.v7),t,this.v8)};const Vt=function(){this.vertices=[],this.triangles=[],this.faces=[],this.boundingBox=null},Wt=function(){this.parse=function(t){this.vertices=[],this.textureVertices=[],this.vertexNormals=[],this.faces=[],this.textures=[],this.normals=[];const e=t.split("\n");for(let t=0;t<e.length;t++)this.parseLine(e[t])},this.parseLine=function(t){const e=this.sanitiseLine(t);if(e&&e.length>0){const t=e.split(" ");if(null!=t&&t.length>0){const e=t[0].toLowerCase(),n=t.slice(1);switch(e){case"v":this.parseVec3(n,this.vertices);break;case"vt":this.parseVec2(n,this.textureVertices);break;case"vn":this.parseVec3(n,this.vertexNormals);break;case"f":this.parseFace(n)}}}},this.sanitiseLine=function(t){let e=t.trim();return e=e.replace(/\s+/g," "),e},this.parseVec2=function(t,e){let n=Rt.create(parseFloat(t[0]),parseFloat(t[1]));e.push(n)},this.parseVec3=function(t,e){let n=Tt.create(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]));e.push(n)},this.parseFace=function(t){const e=this.parseVertexGroup(t[0]),n=e.geometricVertex,i=e.textureVertex,o=e.vertexNormal;for(let e=0;e<t.length-2;e++){const r=this.parseVertexGroup(t[e+1]),s=this.parseVertexGroup(t[e+2]),a=r.geometricVertex,c=r.textureVertex,l=r.vertexNormal,u=s.geometricVertex,h=s.textureVertex,d=s.vertexNormal;this.faces.push(n),this.faces.push(a),this.faces.push(u),this.textures.push(i),this.textures.push(c),this.textures.push(h),this.normals.push(o),this.normals.push(l),this.normals.push(d)}},this.parseVertexGroup=function(t){if(t.indexOf("/")>-1){const e=t.split("/");return{geometricVertex:parseInt(e[0])-1,textureVertex:parseInt(e[1])-1,vertexNormal:parseInt(e[2])-1}}return{geometricVertex:parseInt(t)-1}}};Wt.prototype.load=function(t){this.parse(t);const e=new Vt;return e.vertices=this.vertices,e.vertexCount=this.vertices.length,e.faces=this.faces,e.faceCount=Math.ceil(e.faces.length/3),e.textureVertices=this.textureVertices,e.textureVertexCount=this.textureVertices.length,e.textures=this.textures,e.vertexNormals=this.vertexNormals,e.vertexNormalCount=this.vertexNormals.length,e.normals=this.normals,e};const zt=function(){this.pixels=null,this.width=null,this.height=null},Yt=function(){this.objects=[],this.textures=[],this.lights=[],this.ambientLight=Ut.ambient(),this.separation=Tt.create()};Yt.prototype.update=function(t){for(let e=0;e<this.objects.length;e++)this.objects[e].update(t)},Yt.prototype.trace=function(t,e,n=Number.MAX_SAFE_INTEGER){let i=null,o=n;for(let n=0;n<this.objects.length;n++){const r=this.objects[n],s=r.intersect(t,e,this.separation);null!=s&&s<o&&(i=r,o=s)}return{hitObject:i,t:o}},Yt.prototype.import=function(t,e){switch(e){case"mesh":const e=(new Wt).load(t),n=new Mt;n.mesh=e,this.objects.push(n);break;case"texture":const i=new zt;i.pixels=t.data,i.width=t.width,i.height=t.height,this.textures.push(i);for(let t=0;t<this.objects.length;t++)this.objects[t].material.texture=i}},Yt.prototype.light=function(t){return this.lights.push(t),this};const qt=function(t){this.init=function(t){this.settings=Object.assign({background:Ct.WHITE,showWireframe:!1,wireframeColour:Ct.ORANGE,showFaces:!0,backfaceCulling:!0,translationSpeed:10,rotationSpeed:.5,reverseYAxis:!0,globalRotation:0,globalRotationSpeed:0,backgroundColour:Ct.of(0,0,0,1)},t||{}),this.backgroundColour=this.settings.backgroundColour,this.backgroundColour[0]=255*this.backgroundColour[0],this.backgroundColour[1]=255*this.backgroundColour[1],this.backgroundColour[2]=255*this.backgroundColour[2],this.backgroundColour[3]=255*this.backgroundColour[3],this.world=this.settings.world||new Yt,this.globalRotation=this.settings.globalRotation,this.globalRotationSpeed=this.settings.globalRotationSpeed,this.settings.imageWidth=this.settings.width/Math.round(this.settings.pixelWidth),this.settings.imageHeight=this.settings.height/Math.round(this.settings.pixelHeight),this.canvasRaster=new It(this.settings),this.camera=new Dt(this.settings);const e=Tt.create(0,0,50);this.camera.lookAt(e,Tt.ORIGIN),this.shader=new jt(this.settings),this.depthBuffer=[];for(let t=0;t<this.settings.imageHeight;t++){const t=[];for(let e=0;e<this.settings.imageWidth;e++)t.push(Number.MAX_SAFE_INTEGER);this.depthBuffer.push(t)}this.frameBuffer=[];for(let t=0;t<this.settings.imageHeight;t++){const t=[];for(let e=0;e<this.settings.imageWidth;e++)t.push(Ct.copy(this.backgroundColour,Ct.of(0,0,0,1)));this.frameBuffer.push(t)}this.p0=Rt.create(),this.p1=Rt.create(),this.p2=Rt.create(),this.v0World=Tt.create(),this.v1World=Tt.create(),this.v2World=Tt.create(),this.v0Camera=Tt.create(),this.v1Camera=Tt.create(),this.v2Camera=Tt.create(),this.v0Screen=Ft.create(0,0,0,1),this.v1Screen=Ft.create(0,0,0,1),this.v2Screen=Ft.create(0,0,0,1),this.vp0Screen=Tt.create(),this.vp1Screen=Tt.create(),this.vp2Screen=Tt.create(),this.v0NDC=Rt.create(),this.v1NDC=Rt.create(),this.v2NDC=Rt.create(),this.v0Raster=Rt.create(),this.v1Raster=Rt.create(),this.v2Raster=Rt.create(),this.faceNormal=Tt.create(),this.faceCentre=Tt.create(),this.cameraRay=Tt.create(),this.st0=Tt.create(),this.st1=Tt.create(),this.st2=Tt.create(),this.v15=Tt.create(),this.v16=Tt.create(),this.v17=Tt.create(),this.v18=Tt.create(),this.v19=Tt.create(),this.vn0=Tt.create(),this.vn1=Tt.create(),this.vn2=Tt.create(),this.v23=Tt.create(),this.v24=Tt.create(),this.v25=Tt.create(),this.v26=Tt.create(),this.v27=Tt.create(),this.v28=Tt.create(),this.v29=Tt.create(),this.face={object:null,material:null,st:null,uv:null,normal:null,vn0:null,vn1:null,vn2:null}},this.init(t)};qt.prototype.render=function(t){const e=this.camera,n=this.world.objects,i=this.globalRotationSpeed*t;this.globalRotation=this.globalRotation+i;for(let t=0;t<n.length;t++){const o=n[t],r=o.mesh,s=r.vertices,a=r.faces,c=r.faceCount,l=r.textureVertices,u=r.textures,h=r.vertexNormals,d=r.normals;o.rotation[0]+=.25*i,o.rotation[1]+=.5*i,o.rotation[2]+=.75*i,o.update(),e.update();for(let t=0;t<c;t++){const n=3*t,i=n+1,r=n+2,c=s[a[n]],f=s[a[i]],p=s[a[r]],m=kt.multiplyVector(c,o.localToWorld,this.v0World),g=kt.multiplyVector(f,o.localToWorld,this.v1World),_=kt.multiplyVector(p,o.localToWorld,this.v2World),b=St.triangleNormal(m,g,_,this.faceNormal),v=St.triangleCentroid(m,g,_,this.faceCentre),y=Tt.createDirection(v,e.position,this.cameraRay);let w=!0;if(this.settings.backfaceCulling&&(w=Tt.dot(b,y)>=0),w){const t=e.toCameraSpace(m,this.v0Camera),s=e.toCameraSpace(g,this.v1Camera),a=e.toCameraSpace(_,this.v2Camera),c=e.applyProjection(t,this.v0Screen),f=e.applyProjection(s,this.v1Screen),p=e.applyProjection(a,this.v2Screen);if(this.withinNearAndFar(c,f,p)){const t=this.perspectiveDivide(c,this.vp0Screen),s=this.perspectiveDivide(f,this.vp1Screen),a=this.perspectiveDivide(p,this.vp2Screen),v=e.toNdc(t,this.v0NDC),y=e.toNdc(s,this.v1NDC),w=e.toNdc(a,this.v2NDC),E=e.toRaster(v,this.v0Raster),A=e.toRaster(y,this.v1Raster),x=e.toRaster(w,this.v2Raster);if(this.withinViewport(E,A,x)){const t=St.edgeFunction(E,A,x);if(t>0){const s=1/t;let a=null,v=null,y=null;l&&l.length>0&&(a=Rt.scale(l[u[n]],c[2],this.st0),v=Rt.scale(l[u[i]],f[2],this.st1),y=Rt.scale(l[u[r]],p[2],this.st2));let w=null,C=null,F=null;h&&h.length>0&&(w=h[d[n]],C=h[d[i]],F=h[d[r]],w=Tt.normalised(kt.multiplyDirection(w,o.transformNormals,this.vn0)),C=Tt.normalised(kt.multiplyDirection(C,o.transformNormals,this.vn1)),F=Tt.normalised(kt.multiplyDirection(F,o.transformNormals,this.vn2)));const R=this.p0,S=this.p1,T=this.p2;St.minMaxTriangle(E,A,x,R,S);for(let t=R[1];t<S[1];t++)for(let n=R[0];n<S[0];n++)if(Rt.set(T,n+.5,t+.5),this.insideScreen(T)){let i=St.edgeFunction(A,x,T),r=St.edgeFunction(x,E,T),u=St.edgeFunction(E,A,T);if(i>=0&&r>=0&&u>=0){const h=i*s,d=r*s,E=u*s,A=h*c[2]+d*f[2]+E*p[2];if(A<0){let i=1/A;if(i<this.depthBuffer[t][n]){this.depthBuffer[t][n]=i;let r=Rt.set(this.v19,0,0);l&&l.length>0&&(r=Rt.add(Rt.add(Rt.scale(a,h,this.v15),Rt.scale(v,d,this.v16),this.v17),Rt.scale(y,E,this.v18),this.v19),Rt.scaled(r,i));const s=Tt.add(Tt.add(Tt.scale(m,h,this.v23),Tt.scale(g,d,this.v24),this.v25),Tt.scale(_,E,this.v26),this.v27),c=Tt.createDirection(s,e.position,this.v28),u=this.face;u.object=o,u.material=o.material,u.st=r,u.uv=Tt.set(this.v29,h,d,E),u.normal=b,u.vn0=w,u.vn1=C,u.vn2=F;const f=this.shader.shade(s,u,c);Ct.copy(f,this.frameBuffer[t][n])}}}}}}}}}}for(let t=0;t<this.settings.imageHeight;t++)for(let e=0;e<this.settings.imageWidth;e++){const n=this.frameBuffer[t][e];this.canvasRaster.setPixel(e,t,n),this.depthBuffer[t][e]=Number.MAX_SAFE_INTEGER,Ct.copy(this.backgroundColour,this.frameBuffer[t][e])}this.canvasRaster.update()},qt.prototype.clip=function(t){const e=t[0],n=t[1],i=t[2],o=t[3],r=-o;return e>=r&&e<=o&&n>=r&&n<=o&&i>=r&&i<=o&&Math.abs(o)>0},qt.prototype.withinNearAndFar=function(t,e,n){const i=-t[2],o=-e[2],r=-n[2],s=this.settings,a=s.fNear,c=s.fFar;return i>a&&i<c||o>a&&o<c||r>a&&r<c},qt.prototype.perspectiveDivide=function(t,e){const n=t[3];return e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n,e},qt.prototype.withinViewport=function(t,e,n){const i=t[0],o=t[1],r=(t[2],e[0]),s=e[1],a=(e[2],n[0]),c=n[1],l=(n[2],this.settings),u=l.imageWidth,h=l.imageHeight;return l.fNear,l.fFar,i>=0&&i<u&&o>=0&&o<h||r>=0&&r<u&&s>=0&&s<h||a>=0&&a<u&&c>=0&&c<h},qt.prototype.insideScreen=function(t){const e=t[0],n=t[1],i=this.settings.imageWidth,o=this.settings.imageHeight;return e>=0&&e<i&&n>=0&&n<o};const Kt=function(t){this._init=function(t){this.vertices=t;const e=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,i=Tt.create(e,e,e),o=Tt.create(n,n,n);for(let e=0;e<t.length;++e)t[e][0]<i[0]&&(i[0]=t[e][0]),t[e][1]<i[1]&&(i[1]=t[e][1]),t[e][2]<i[2]&&(i[2]=t[e][2]),t[e][0]>o[0]&&(o[0]=t[e][0]),t[e][1]>o[1]&&(o[1]=t[e][1]),t[e][2]>o[2]&&(o[2]=t[e][2]);const r=i[0],s=o[0],a=i[1],c=o[1],l=i[2],u=o[2],h=s-r,d=.5*h,f=c-a,p=.5*f,m=u-l,g=.5*m,_=r+d,b=a+p,v=l+g;this.min=i,this.max=o,this.left=r,this.right=s,this.bottom=a,this.top=c,this.back=l,this.front=u,this.width=h,this.halfWidth=d,this.height=f,this.halfHeight=p,this.depth=m,this.halfDepth=g,this.centreLeft=Tt.create(r,b,v),this.centreRight=Tt.create(s,b,v),this.centreBottom=Tt.create(_,a,v),this.centreTop=Tt.create(_,c,v),this.centreBack=Tt.create(_,b,l),this.centreFront=Tt.create(_,b,u),this.centre=Tt.create(_,b,v)},this._init(t)};Kt.prototype.init=function(t){this._init(t)},Kt.prototype.update=function(){this._init(this.vertices)},Kt.prototype.toString=function(){return JSON.stringify(this,null,2)};const Xt=[[0,39.034,0],[.76212,36.843,0],[3,36.604,0],[1,35.604,0],[2.0162,33.382,0],[0,34.541,0],[-2.0162,33.382,0],[-1,35.604,0],[-3,36.604,0],[-.76212,36.843,0],[-.040181,34.31,0],[3.2778,30.464,0],[-.040181,30.464,0],[-.028749,30.464,0],[3.2778,30.464,0],[1.2722,29.197,0],[1.2722,29.197,0],[-.028703,29.197,0],[1.2722,29.197,0],[5.2778,25.398,0],[-.02865,25.398,0],[1.2722,29.197,0],[5.2778,25.398,0],[3.3322,24.099,0],[-.028683,24.099,0],[7.1957,20.299,0],[-.02861,20.299,0],[5.2778,19.065,0],[-.028663,18.984,0],[9.2778,15.265,0],[-.028571,15.185,0],[9.2778,15.265,0],[7.3772,13.999,0],[-.028625,13.901,0],[9.2778,15.265,0],[12.278,8.9323,0],[-.028771,8.9742,0],[12.278,8.9323,0],[10.278,7.6657,0],[-.028592,7.6552,0],[15.278,2.5994,0],[-.028775,2.6077,0],[15.278,2.5994,0],[13.278,1.3329,0],[-.028727,1.2617,0],[18.278,-3.7334,0],[18.278,-3.7334,0],[2.2722,-1.2003,0],[-.028727,-1.3098,0],[4.2722,-5,0],[4.2722,-5,0],[-.028727,-5,0],[-3.3582,30.464,0],[-3.3582,30.464,0],[-1.3526,29.197,0],[-1.3526,29.197,0],[-1.3526,29.197,0],[-5.3582,25.398,0],[-1.3526,29.197,0],[-5.3582,25.398,0],[-3.4126,24.099,0],[-7.276,20.299,0],[-5.3582,19.065,0],[-9.3582,15.265,0],[-9.3582,15.265,0],[-7.4575,13.999,0],[-9.3582,15.265,0],[-12.358,8.9323,0],[-12.358,8.9323,0],[-10.358,7.6657,0],[-15.358,2.5994,0],[-15.358,2.5994,0],[-13.358,1.3329,0],[-18.358,-3.7334,0],[-18.358,-3.7334,0],[-2.3526,-1.2003,0],[-4.3526,-5,0],[-4.3526,-5,0],[0,34.31,.040181],[0,30.464,-3.2778],[0,30.464,.040181],[0,30.464,.028749],[0,30.464,-3.2778],[0,29.197,-1.2722],[0,29.197,-1.2722],[0,29.197,.028703],[0,29.197,-1.2722],[0,25.398,-5.2778],[0,25.398,.02865],[0,29.197,-1.2722],[0,25.398,-5.2778],[0,24.099,-3.3322],[0,24.099,.028683],[0,20.299,-7.1957],[0,20.299,.02861],[0,19.065,-5.2778],[0,18.984,.028663],[0,15.265,-9.2778],[0,15.185,.028571],[0,15.265,-9.2778],[0,13.999,-7.3772],[0,13.901,.028625],[0,15.265,-9.2778],[0,8.9323,-12.278],[0,8.9742,.028771],[0,8.9323,-12.278],[0,7.6657,-10.278],[0,7.6552,.028592],[0,2.5994,-15.278],[0,2.6077,.028775],[0,2.5994,-15.278],[0,1.3329,-13.278],[0,1.2617,.028727],[0,-3.7334,-18.278],[0,-3.7334,-18.278],[0,-1.2003,-2.2722],[0,-1.3098,.028727],[0,-5,-4.2722],[0,-5,-4.2722],[0,-5,.028727],[0,30.464,3.3582],[0,30.464,3.3582],[0,29.197,1.3526],[0,29.197,1.3526],[0,29.197,1.3526],[0,25.398,5.3582],[0,29.197,1.3526],[0,25.398,5.3582],[0,24.099,3.4126],[0,20.299,7.276],[0,19.065,5.3582],[0,15.265,9.3582],[0,15.265,9.3582],[0,13.999,7.4575],[0,15.265,9.3582],[0,8.9323,12.358],[0,8.9323,12.358],[0,7.6657,10.358],[0,2.5994,15.358],[0,2.5994,15.358],[0,1.3329,13.358],[0,-3.7334,18.358],[0,-3.7334,18.358],[0,-1.2003,2.3526],[0,-5,4.3526],[0,-5,4.3526]],$t=[8,7,9,6,5,7,4,3,5,2,1,3,0,9,1,5,3,7,7,3,9,9,3,1,10,12,11,13,15,14,15,13,16,13,17,16,18,20,19,17,20,21,20,23,22,20,24,23,23,26,25,24,26,23,26,27,25,26,28,27,27,30,29,28,30,27,30,32,31,30,33,32,27,30,34,32,36,35,33,36,32,36,38,37,36,39,38,38,41,40,39,41,38,41,43,42,41,44,43,44,45,43,44,47,46,44,48,47,48,49,47,48,51,50,10,52,12,13,53,54,55,17,54,13,54,17,56,57,20,17,58,20,20,59,60,20,60,24,60,61,26,24,60,26,26,61,62,26,62,28,62,63,30,28,62,30,30,64,65,30,65,33,62,66,30,65,67,36,33,65,36,36,68,69,36,69,39,69,70,41,39,69,41,41,71,72,41,72,44,44,72,73,44,74,75,44,75,48,48,75,76,48,77,51,78,80,79,81,83,82,83,81,84,81,85,84,86,88,87,85,88,89,88,91,90,88,92,91,91,94,93,92,94,91,94,95,93,94,96,95,95,98,97,96,98,95,98,100,99,98,101,100,95,98,102,100,104,103,101,104,100,104,106,105,104,107,106,106,109,108,107,109,106,109,111,110,109,112,111,112,113,111,112,115,114,112,116,115,116,117,115,116,119,118,78,120,80,81,121,122,123,85,122,81,122,85,124,125,88,85,126,88,88,127,128,88,128,92,128,129,94,92,128,94,94,129,130,94,130,96,130,131,98,96,130,98,98,132,133,98,133,101,130,134,98,133,135,104,101,133,104,104,136,137,104,137,107,137,138,109,107,137,109,109,139,140,109,140,112,112,140,141,112,142,143,112,143,116,116,143,144,116,145,119],Qt=[[0,0,0],[0,1,0],[1,1,0],[0,0,0],[1,1,0],[1,0,0],[1,0,0],[1,1,0],[1,1,1],[1,0,0],[1,1,1],[1,0,1],[1,0,1],[1,1,1],[0,1,1],[1,0,1],[0,1,1],[0,0,1],[0,0,1],[0,1,1],[0,1,0],[0,0,1],[0,1,0],[0,0,0],[0,1,0],[0,1,1],[1,1,1],[0,1,0],[1,1,1],[1,1,0],[1,0,1],[0,0,1],[0,0,0],[1,0,1],[0,0,0],[1,0,0]],Jt=function(){};Jt.prototype={get:function(t){const e=new Vt;switch(t){case"christmas-tree":e.vertices=Xt,e.faces=$t,e.faceCount=128,e.boundingBox=new Kt(e.vertices);break;case"cube":e.vertices=Qt,e.faces=[];for(let t=0;t<36;t++)e.faces.push(t);for(let t=0;t<e.vertices.length;t+=3){const n={v0:e.vertices[t],v1:e.vertices[t+1],v2:e.vertices[t+2],colour:{red:1,green:1,blue:1}};e.triangles.push(n)}e.faceCount=12,e.boundingBox=new Kt(e.vertices)}return e}};const Zt="mesh",te="geometric",ee=function(){this.meshFactory=new Jt,this.meshLoader=new Wt,this.v0=Tt.create(),this.v1=Tt.create()};ee.prototype.meshObject=function(t){return{type:Zt,mesh:t.mesh,position:t.position||Tt.create(),rotation:t.rotation||Tt.create()}},ee.prototype.wavefrontObject=function(t){return{type:Zt,mesh:this.meshLoader.load(t.data),position:t.position||Tt.create(),rotation:t.rotation||Tt.create()}},ee.prototype.disk=function(t){const e=new Mt;return e.normal=t.normal||Tt.create(),e.position=t.position||Tt.create(),e.radius=t.radius||1,e.radiusSquared=t.radius*t.radius||1,e.rotation=t.rotation||Tt.create(),e.material=t.material||new Bt,t.type===te?(e.type=te,e.intersect=function(t,n){return St.intersectRayAndDisk(t,n,e.position,e.normal,e.radiusSquared)},e.getSurfaceAt=function(t){const n=Tt.normalised(Tt.subtract(t,e.position,this.v0)),i=.5*(1+Math.atan2(n[2],n[0])/Math.PI),o=Math.acos(n[1])/Math.PI,r=Tt.set(this.v1,i,o,0);return{object:e,material:e.material,normal:n,st:r}}):e.type=Zt,e},ee.prototype.plane=function(t){const e=new Mt;return e.normal=t.normal||Tt.create(),e.position=t.position||Tt.create(),e.rotation=t.rotation||Tt.create(),e.material=t.material||new Bt,t.type===te?(e.type=te,e.intersect=function(t,n,i){return St.intersectRayAndPlane(t,n,e.position,e.normal)},e.getSurfaceAt=function(t){const n=e.normal,i=Tt.copy(t,this.v1);return{object:e,material:e.material,normal:n,st:i}}):e.type=Zt,e},ee.prototype.sphere=function(t){const e=new Mt;return e.radius=t.radius||1,e.radiusSquared=e.radius*e.radius,e.position=t.position||Tt.create(),e.rotation=t.rotation||Tt.create(),e.material=t.material||new Bt,e.positionAndOrient(e.position),t.type===te?(e.type=te,e.intersect=function(t,n,i){return St.intersectRayAndSphere(t,n,e.position,e.radiusSquared,i)},e.getSurfaceAt=function(t){const n=Tt.normalised(Tt.subtract(t,e.position,this.v0)),i=.5*(1+Math.atan2(n[2],n[0])/Math.PI),o=Math.acos(n[1])/Math.PI,r=Tt.set(this.v1,i,o,0);return{object:e,material:e.material,normal:n,st:r}}):e.type=Zt,e},ee.prototype.cube=function(t){const e=new Mt;return e.position=t.position||Tt.create(),e.rotation=t.rotation||Tt.create(),e.material=t.material||new Bt,e.positionAndOrient(e.position),e.min=t.min,e.max=t.max,t.type===te?e.type=te:(e.type=Zt,e.mesh=this.meshFactory.get("cube",t)),e},ee.prototype.terrain=function(t){return function(t,e,n){const i=new Noise(Math.random()),o=[],r=[];function s(t,e,n=4,o=.5,r=2){let s=0,a=1,c=1,l=0;for(let u=0;u<n;u++)s+=i.perlin2(t*a,e*a)*c,l+=c,c*=o,a*=r;return s/l}for(let e=0;e<100;e++)for(let n=0;n<t;n++){const i=(20*s(n/t*4,e/100*4)).toFixed(2);o.push([n,i,e])}for(let e=0;e<99;e++)for(let n=0;n<99;n++){const i=e*t+n+1,o=i+1,s=i+t,a=i+t+1;r.push([i,s,o]),r.push([o,s,a])}let a="";for(const t of o)a+=`v ${t[0]} ${t[1]} ${t[2]}\n`;for(const t of r)a+=`f ${t[0]} ${t[1]} ${t[2]}\n`;return a}(100)},ee.prototype.perlinSphere=function(){return function(t,e,n){const i=new Noise(Math.random()),o=[],r=[];function s(t,e,n,o=4,r=.5,s=2){let a=0,c=1,l=1,u=0;for(let h=0;h<o;h++)a+=i.perlin3(t*c,e*c,n*c)*l,u+=l,l*=r,c*=s;return a/u}for(let t=0;t<=128;t++){const n=t*Math.PI/128,i=Math.sin(n),r=Math.cos(n);for(let t=0;t<=e;t++){const n=2*t*Math.PI/e,a=Math.sin(n),c=Math.cos(n)*i,l=r,u=a*i,h=1+.3*s(c,l,u),d=10*c*h,f=10*l*h,p=10*u*h;o.push([d.toFixed(3),f.toFixed(3),p.toFixed(3)])}}for(let t=0;t<128;t++)for(let n=0;n<e;n++){const i=257*t+n+1,o=i+e+1;r.push([i,o,i+1]),r.push([i+1,o,o+1])}let a="";for(const t of o)a+=`v ${t[0]} ${t[1]} ${t[2]}\n`;for(const t of r)a+=`f ${t[0]} ${t[1]} ${t[2]}\n`;return a}(0,256)},ee.prototype.perlinCube=function(){return function(t,e){const n=new Noise(Math.random()),i=[],o=[],r=new Map;let s=1;const a=[{name:"right",u:"z",v:"y",fixed:"x",sign:1},{name:"left",u:"z",v:"y",fixed:"x",sign:-1},{name:"top",u:"x",v:"z",fixed:"y",sign:1},{name:"bottom",u:"x",v:"z",fixed:"y",sign:-1},{name:"front",u:"x",v:"y",fixed:"z",sign:1},{name:"back",u:"x",v:"y",fixed:"z",sign:-1}],c=[];function l(t,e,i,o=4,r=.5,s=2){let a=0,c=1,l=1,u=0;for(let h=0;h<o;h++)a+=n.perlin3(t*l,e*l,i*l)*c,u+=c,c*=r,l*=s;return a/u}for(const e of a)for(let n=0;n<=t;n++)for(let o=0;o<=t;o++){const a=o/t*2-1,u=n/t*2-1;let h={x:0,y:0,z:0};h[e.u]=a,h[e.v]=u,h[e.fixed]=e.sign;let d=Math.hypot(h.x,h.y,h.z),f=h.x/d,p=h.y/d,m=h.z/d;const g=10*l(f,p,m),_=f*(50+g),b=p*(50+g),v=m*(50+g),y=`${_.toFixed(5)}_${b.toFixed(5)}_${v.toFixed(5)}`;r.has(y)||(r.set(y,s++),i.push([_,b,v])),c.push({key:y})}for(let e=0;e<6;e++){const n=676*e;for(let e=0;e<t;e++)for(let i=0;i<t;i++){const t=n+26*e+i,s=t+1,a=t+26,l=a+1,u=r.get(c[t].key),h=r.get(c[a].key),d=r.get(c[s].key),f=r.get(c[l].key);o.push([u,h,d]),o.push([d,h,f])}}let u="";for(const[t,e,n]of i)u+=`v ${t.toFixed(4)} ${e.toFixed(4)} ${n.toFixed(4)}\n`;for(const[t,e,n]of o)u+=`f ${t} ${e} ${n}\n`;return u}(25)},ee.prototype.perlinIcosphere=function(t=60,e=50,n=6){class i{constructor(t,e,n){this.x=t,this.y=e,this.z=n}add(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z)}mul(t){return new i(this.x*t,this.y*t,this.z*t)}normalize(){const t=Math.hypot(this.x,this.y,this.z);return new i(this.x/t,this.y/t,this.z/t)}key(){return`${this.x.toFixed(5)}_${this.y.toFixed(5)}_${this.z.toFixed(5)}`}}return function(){const{vertices:o,faces:r}=function(t){const e=(1+Math.sqrt(5))/2;let n=[new i(-1,e,0),new i(1,e,0),new i(-1,-e,0),new i(1,-e,0),new i(0,-1,e),new i(0,1,e),new i(0,-1,-e),new i(0,1,-e),new i(e,0,-1),new i(e,0,1),new i(-e,0,-1),new i(-e,0,1)].map((t=>t.normalize())),o=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];const r=new Map;function s(t,e){const i=t<e?`${t}_${e}`:`${e}_${t}`;if(r.has(i))return r.get(i);const o=n[t].add(n[e]).mul(.5).normalize(),s=n.length;return n.push(o),r.set(i,s),s}for(let e=0;e<t;e++){const t=[];for(const[e,n,i]of o){const o=s(e,n),r=s(n,i),a=s(i,e);t.push([e,o,a],[n,r,o],[i,a,r],[o,r,a])}o=t}return{vertices:n,faces:o}}(n),s=new Noise(Math.random()),a=o.map((n=>{const i=.5*function(t,e,n,i,o=4){let r=0,s=1,a=1,c=0;for(let l=0;l<o;l++)r+=t.perlin3(e*a,n*a,i*a)*s,c+=s,s*=.5,a*=2;return r/c}(s,n.x,n.y,n.z)+.5,o=e+i*t;return n.normalize().mul(o)}));let c="";return a.forEach((t=>c+=`v ${t.x.toFixed(5)} ${t.y.toFixed(5)} ${t.z.toFixed(5)}\n`)),r.forEach((([t,e,n])=>c+=`f ${t+1} ${e+1} ${n+1}\n`)),c}()};const ne=function(t){this.init=function(t){this.settings=Object.assign({background:Ct.WHITE,showWireframe:!1,wireframeColour:Ct.ORANGE,showFaces:!0,backfaceCulling:!0,translationSpeed:100,rotationSpeed:.5,reverseYAxis:!0,globalRotation:0,globalRotationSpeed:0,backgroundColour:Ct.of(255,255,255,255),world:new Yt},t||{}),this.backgroundColour=this.settings.backgroundColour,this.world=this.settings.world,this.globalRotation=this.settings.globalRotation,this.globalRotationSpeed=this.settings.globalRotationSpeed;const e=new ee;for(let t=0;t<12;t++){const t=Tt.create(250*(.5-Math.random()),250*(.5-Math.random()),.5+250*Math.random()),n=.5+64*Math.random(),i=Math.PI*(90*Math.random())/180,o=5*Math.random(),r=e.sphere({type:te,position:t,radius:n});r.positionAndOrient(r.position),r.bob=i,r.amp=o,this.world.objects.push(r)}this.settings.imageWidth=this.settings.width/Math.round(this.settings.pixelWidth),this.settings.imageHeight=this.settings.height/Math.round(this.settings.pixelHeight),this.canvasRaster=new It(this.settings),this.camera=new Dt(this.settings);const n=Tt.create(0,0,450);this.camera.lookAt(n,Tt.ORIGIN),this.shader=new jt(this.settings),this.v1=Tt.create(),this.v2=Tt.create(),this.v9=Tt.create(),this.v10=Tt.create(),this.v11=Tt.create(),this.v12=Tt.create(),this.v13=Tt.create()},this.init(t)};ne.prototype.render=function(t){const e=this.camera;this.globalRotationDelta=this.globalRotationSpeed*t,this.globalRotation=this.globalRotation+this.globalRotationDelta;const n=Math.tan(St.toRadians(.5*this.settings.fov)),i=this.settings.imageWidth/this.settings.imageHeight;for(let t=0;t<this.world.objects.length;t++){const e=this.world.objects[t];e.bob+=.08;const n=e.amp*Math.sin(e.bob);Tt.added(e.position,Tt.normalise(e.forward,n)),Tt.added(e.position,Tt.normalise(e.up,n)),Tt.added(e.position,Tt.normalise(e.right,n)),e.update()}e.update(),this.world.update(t);for(let t=0;t<this.settings.imageHeight;t++)for(let o=0;o<this.settings.imageWidth;o++){const r=(2*(o+.5)/this.settings.imageWidth-1)*n,s=(1-2*(t+.5)/this.settings.imageHeight)*n*1/i,a=this.v9,c=Tt.set(this.v10,r,s,-1);kt.multiplyDirection(c,e.cameraToWorld,a),Tt.normalised(a);const l=this.castRay(e,a);this.canvasRaster.setPixel(o,t,l)}this.canvasRaster.update()},ne.prototype.castRay=function(t,e){let n=this.backgroundColour;const i=t.position,o=this.world.trace(i,e);if(null!=o.hitObject){const r=o.hitObject,s=o.t,a=Tt.add(i,Tt.scale(e,s,this.v11),this.v12),c=r.getSurfaceAt(a),l=Tt.createDirection(a,t.position,this.v13);n=this.shader.shade(a,c,l)}return n};const ie=function(){};ie.prototype.loadText=function(t,e){const n=new FileReader;n.onload=function(){e(n.result)},n.readAsText(t)},ie.prototype.loadImage=function(t,e){const n=new FileReader;n.onload=function(){const t=document.createElement("img");t.setAttribute("style","display: none;"),document.body.appendChild(t);const i=new Image;i.onload=function(){t.src=this.src;const n=t.width,i=t.height,o=document.createElement("canvas");o.setAttribute("style","display: none;"),o.width=n,o.height=i,document.body.appendChild(o);const r=o.getContext("2d");r.drawImage(t,0,0,n,i);const s=r.getImageData(0,0,n,i).data;o.remove(),t.remove(),e({data:s,width:n,height:i})},i.src=n.result},n.readAsDataURL(t)};const oe=function(t){this.init=function(t){this.settings=Object.assign({background:Ct.WHITE,showWireframe:!1,wireframeColour:Ct.ORANGE,showFaces:!0,backfaceCulling:!0,translationSpeed:10,rotationSpeed:.5,reverseYAxis:!0,globalRotation:0,globalRotationSpeed:0,backgroundColour:Uint8ClampedArray.of(0,0,0,255),world:new Yt},t||{}),this.backgroundColour=Ct.toRgb(this.settings.backgroundColour),this.world=this.settings.world||new Yt,this.globalRotation=this.settings.globalRotation,this.globalRotationSpeed=this.settings.globalRotationSpeed,this.settings.imageWidth=this.settings.width/this.settings.pixelWidth,this.settings.imageHeight=this.settings.height/this.settings.pixelHeight,this.canvasElem=document.getElementById(this.settings.canvas),this.canvasElem.setAttribute("width",this.settings.width),this.canvasElem.setAttribute("height",this.settings.height),this.ctx=this.canvasElem.getContext("2d"),this.camera=new Dt(this.settings);const e=Tt.create(0,0,5);this.camera.lookAt(e,Tt.ORIGIN),this.shader=new jt(this.settings),this.p0=Rt.create(),this.p1=Rt.create(),this.p2=Rt.create(),this.faceNormal=Tt.create(),this.faceCentre=Tt.create(),this.cameraRay=Tt.create(),this.v0=Tt.create(),this.v1=Tt.create(),this.v2=Tt.create(),this.face={object:null,material:null,normal:null}},this.init(t)};oe.prototype.render=function(t){const e=this.camera,n=this.world.objects,i=this.globalRotationSpeed*t;this.globalRotation=this.globalRotation+i;const o=[];for(let t=0;t<n.length;t++){const r=n[t],s=r.mesh,a=s.vertices,c=s.faces,l=s.faceCount;r.rotation[0]+=.25*i,r.rotation[1]+=.5*i,r.rotation[2]+=.75*i,r.update(),e.update();for(let t=0;t<l;t++){let n=a[c[3*t]],i=a[c[3*t+1]],s=a[c[3*t+2]];const l=Tt.create(),u=Tt.create(),h=Tt.create();n=kt.multiplyVector(n,r.localToWorld,this.v0),i=kt.multiplyVector(i,r.localToWorld,this.v1),s=kt.multiplyVector(s,r.localToWorld,this.v2);const d=e.triangleNormal(n,i,s,this.faceNormal),f=St.triangleCentroid(n,i,s,this.faceCentre),p=Tt.createDirection(f,e.position,this.cameraRay);let m=!0;if(this.settings.backfaceCulling&&(m=Tt.dot(d,p)>0),m&&(e.applyProjectionAndConvertToNDC(n,l),e.applyProjectionAndConvertToNDC(i,u),e.applyProjectionAndConvertToNDC(s,h),this.insideScreen(l)||this.insideScreen(u)||this.insideScreen(h))){const t=this.p0,e=this.p1;this.p2,St.minMaxTriangle(l,u,h,t,e);const n=this.face;n.object=r,n.material=r.material,n.normal=d;const i=this.shader.shade(f,n),s=Ct.toRgb(i);o.push({fillColour:s,v0:l,v1:u,v2:h})}}}o.sort((function(t,e){return(t.v0[2]+t.v1[2]+t.v2[2])/3-(e.v0[2]+e.v1[2]+e.v2[2])/3})),this.ctx.fillStyle=this.backgroundColour,this.ctx.fillRect(0,0,this.canvasElem.width,this.canvasElem.height);for(let t=0;t<o.length;t++){const e=o[t],n=e.fillColour,i=e.v0,r=e.v1,s=e.v2;Tt.scaled(i,this.settings.pixelWidth),Tt.scaled(r,this.settings.pixelWidth),Tt.scaled(s,this.settings.pixelWidth),this.ctx.beginPath(),this.ctx.moveTo(i[0],i[1]),this.ctx.lineTo(r[0],r[1]),this.ctx.lineTo(s[0],s[1]),this.ctx.lineTo(i[0],i[1]),this.ctx.closePath(),this.settings.showWireframe?(this.ctx.strokeStyle=this.settings.wireframeColour,this.ctx.fillStyle=n):(this.ctx.strokeStyle=n,this.ctx.fillStyle=n),this.settings.showFaces?(this.ctx.fill(),this.ctx.stroke()):this.ctx.stroke()}},oe.prototype.insideScreen=function(t){const e=t[0],n=t[1],i=-t[2],o=this.settings.imageWidth,r=this.settings.imageHeight,s=this.settings.fNear,a=this.settings.fFar;return e>=0&&e<=o&&n>=0&&n<=r&&i>=s&&i<=a};const re=function(t){const e=this;switch(this.resourceLoader=new ie,t.renderer){case"vector":this.renderer=new oe(t);break;case"raytrace":this.renderer=new ne(t);break;default:this.renderer=new qt(t)}this.world=t.world;const n=document.getElementById(t.canvas);n.addEventListener("dragover",(function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"}),!1),n.addEventListener("drop",(function(t){t.stopPropagation(),t.preventDefault();const n=t.dataTransfer.files;for(let t=0;t<n.length;t++){const i=n[t];switch(i.name.split(".")[1].toLowerCase()){case"obj":e.resourceLoader.loadText(i,(function(t){e.world.import(t,"mesh")}));break;case"jpg":case"jpeg":case"png":e.resourceLoader.loadImage(i,(function(t){e.world.import(t,"texture")}))}}}),!1),this.keyPressed={},window.addEventListener("keydown",(function(t){if(t.key){const n=t.key.toUpperCase();e.keyPressed[n]=!0}})),window.addEventListener("keyup",(function(t){if(t.key){const n=t.key.toUpperCase();e.keyPressed[n]=!1}})),window.addEventListener("keyup",(function(t){if(t.key){const n=t.key.toUpperCase();e.handleKeyUp(n)}}))};re.prototype.handleKeyUp=function(t){"F"===t&&At()},re.prototype.handleKeyPress=function(t){const e=this.renderer.settings,n=e.translationSpeed*t,i=e.rotationSpeed*t,o=e.reverseYAxis?-1:1,r=this.renderer.camera;this.keyPressed.W&&r.moveForward(n),this.keyPressed.A&&r.moveLeft(n),this.keyPressed.S&&r.moveBackward(n),this.keyPressed.D&&r.moveRight(n),this.keyPressed.O&&r.moveUp(n),this.keyPressed.U&&r.moveDown(n),this.keyPressed.J&&r.yawLeft(i),this.keyPressed.L&&r.yawRight(i),this.keyPressed.I&&r.pitchUp(i*o),this.keyPressed.K&&r.pitchDown(i*o),this.keyPressed.Q&&r.rollCounterClockwise(i),this.keyPressed.E&&r.rollClockwise(i)},re.prototype.run=function(){const t=this;let e,n,i=Date.now(),o=1e3/24;!function r(){requestAnimationFrame(r),e=Date.now(),n=e-i,n>o&&(i=e-n%o,t.handleKeyPress(n),t.renderer.render(n))}()};class se{constructor(t){this.light=t}get value(){return[255*this.light.red,255*this.light.green,255*this.light.blue]}set value(t){console.log(t),this.light.red=t[0]/255,this.light.green=t[1]/255,this.light.blue=t[2]/255}}class ae{constructor(t,e){this.light=t,this.coordinate=e}get value(){return this.light.object.position[this.coordinate]}set value(t){const e=this.light.object.position;e[this.coordinate]=t,this.light.object.positionAndOrient(e)}}function ce(t,e){var n=t.__state.conversionName.toString(),i=Math.round(t.r),o=Math.round(t.g),r=Math.round(t.b),s=t.a,a=Math.round(t.h),c=t.s.toFixed(1),l=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var u=t.hex.toString(16);u.length<6;)u="0"+u;return"#"+u}return"CSS_RGB"===n?"rgb("+i+","+o+","+r+")":"CSS_RGBA"===n?"rgba("+i+","+o+","+r+","+s+")":"HEX"===n?"0x"+t.hex.toString(16):"RGB_ARRAY"===n?"["+i+","+o+","+r+"]":"RGBA_ARRAY"===n?"["+i+","+o+","+r+","+s+"]":"RGB_OBJ"===n?"{r:"+i+",g:"+o+",b:"+r+"}":"RGBA_OBJ"===n?"{r:"+i+",g:"+o+",b:"+r+",a:"+s+"}":"HSV_OBJ"===n?"{h:"+a+",s:"+c+",v:"+l+"}":"HSVA_OBJ"===n?"{h:"+a+",s:"+c+",v:"+l+",a:"+s+"}":"unknown format"}var le=Array.prototype.forEach,ue=Array.prototype.slice,he={BREAK:{},extend:function(t){return this.each(ue.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(e[n])||(t[n]=e[n])}.bind(this))}),this),t},defaults:function(t){return this.each(ue.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(t[n])&&(t[n]=e[n])}.bind(this))}),this),t},compose:function(){var t=ue.call(arguments);return function(){for(var e=ue.call(arguments),n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},each:function(t,e,n){if(t)if(le&&t.forEach&&t.forEach===le)t.forEach(e,n);else if(t.length===t.length+0){var i,o=void 0;for(o=0,i=t.length;o<i;o++)if(o in t&&e.call(n,t[o],o)===this.BREAK)return}else for(var r in t)if(e.call(n,t[r],r)===this.BREAK)return},defer:function(t){setTimeout(t,0)},debounce:function(t,e,n){var i=void 0;return function(){var o=this,r=arguments;function s(){i=null,n||t.apply(o,r)}var a=n||!i;clearTimeout(i),i=setTimeout(s,e),a&&t.apply(o,r)}},toArray:function(t){return t.toArray?t.toArray():ue.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return isNaN(t)})),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return t instanceof Function}},de=[{litmus:he.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:ce},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:ce},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:ce},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:ce}}},{litmus:he.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:he.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:he.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(he.isNumber(t.r)&&he.isNumber(t.g)&&he.isNumber(t.b)&&he.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(he.isNumber(t.r)&&he.isNumber(t.g)&&he.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(he.isNumber(t.h)&&he.isNumber(t.s)&&he.isNumber(t.v)&&he.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(he.isNumber(t.h)&&he.isNumber(t.s)&&he.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],fe=void 0,pe=void 0,me=function(){pe=!1;var t=arguments.length>1?he.toArray(arguments):arguments[0];return he.each(de,(function(e){if(e.litmus(t))return he.each(e.conversions,(function(e,n){if(fe=e.read(t),!1===pe&&!1!==fe)return pe=fe,fe.conversionName=n,fe.conversion=e,he.BREAK})),he.BREAK})),pe},ge=void 0,_e={hsv_to_rgb:function(t,e,n){var i=Math.floor(t/60)%6,o=t/60-Math.floor(t/60),r=n*(1-e),s=n*(1-o*e),a=n*(1-(1-o)*e),c=[[n,a,r],[s,n,r],[r,n,a],[r,s,n],[a,r,n],[n,r,s]][i];return{r:255*c[0],g:255*c[1],b:255*c[2]}},rgb_to_hsv:function(t,e,n){var i=Math.min(t,e,n),o=Math.max(t,e,n),r=o-i,s=void 0;return 0===o?{h:NaN,s:0,v:0}:(s=t===o?(e-n)/r:e===o?2+(n-t)/r:4+(t-e)/r,(s/=6)<0&&(s+=1),{h:360*s,s:r/o,v:o/255})},rgb_to_hex:function(t,e,n){var i=this.hex_with_component(0,2,t);return i=this.hex_with_component(i,1,e),this.hex_with_component(i,0,n)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,n){return n<<(ge=8*e)|t&~(255<<ge)}},be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ve=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},ye=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),we=function t(e,n,i){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,n,i)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(i):void 0},Ee=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},Ae=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},xe=function(){function t(){if(ve(this,t),this.__state=me.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return ye(t,[{key:"toString",value:function(){return ce(this)}},{key:"toHexString",value:function(){return ce(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function Ce(t,e,n){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space||xe.recalculateRGB(this,e,n),this.__state[e]},set:function(t){"RGB"!==this.__state.space&&(xe.recalculateRGB(this,e,n),this.__state.space="RGB"),this.__state[e]=t}})}function Fe(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space||xe.recalculateHSV(this),this.__state[e]},set:function(t){"HSV"!==this.__state.space&&(xe.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}xe.recalculateRGB=function(t,e,n){if("HEX"===t.__state.space)t.__state[e]=_e.component_from_hex(t.__state.hex,n);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");he.extend(t.__state,_e.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},xe.recalculateHSV=function(t){var e=_e.rgb_to_hsv(t.r,t.g,t.b);he.extend(t.__state,{s:e.s,v:e.v}),he.isNaN(e.h)?he.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},xe.COMPONENTS=["r","g","b","h","s","v","hex","a"],Ce(xe.prototype,"r",2),Ce(xe.prototype,"g",1),Ce(xe.prototype,"b",0),Fe(xe.prototype,"h"),Fe(xe.prototype,"s"),Fe(xe.prototype,"v"),Object.defineProperty(xe.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(xe.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=_e.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var Re=function(){function t(e,n){ve(this,t),this.initialValue=e[n],this.domElement=document.createElement("div"),this.object=e,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return ye(t,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),Se={};he.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(t,e){he.each(t,(function(t){Se[t]=e}))}));var Te=/(\d+(\.\d+)?)px/;function ke(t){if("0"===t||he.isUndefined(t))return 0;var e=t.match(Te);return he.isNull(e)?0:parseFloat(e[1])}var Oe={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,n){var i=n,o=e;he.isUndefined(o)&&(o=!0),he.isUndefined(i)&&(i=!0),t.style.position="absolute",o&&(t.style.left=0,t.style.right=0),i&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,n,i){var o=n||{},r=Se[e];if(!r)throw new Error("Event type "+e+" not supported.");var s=document.createEvent(r);switch(r){case"MouseEvents":var a=o.x||o.clientX||0,c=o.y||o.clientY||0;s.initMouseEvent(e,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,a,c,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var l=s.initKeyboardEvent||s.initKeyEvent;he.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),l(e,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break;default:s.initEvent(e,o.bubbles||!1,o.cancelable||!0)}he.defaults(s,i),t.dispatchEvent(s)},bind:function(t,e,n,i){var o=i||!1;return t.addEventListener?t.addEventListener(e,n,o):t.attachEvent&&t.attachEvent("on"+e,n),Oe},unbind:function(t,e,n,i){var o=i||!1;return t.removeEventListener?t.removeEventListener(e,n,o):t.detachEvent&&t.detachEvent("on"+e,n),Oe},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var n=t.className.split(/ +/);-1===n.indexOf(e)&&(n.push(e),t.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return Oe},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var n=t.className.split(/ +/),i=n.indexOf(e);-1!==i&&(n.splice(i,1),t.className=n.join(" "))}else t.className=void 0;return Oe},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return ke(e["border-left-width"])+ke(e["border-right-width"])+ke(e["padding-left"])+ke(e["padding-right"])+ke(e.width)},getHeight:function(t){var e=getComputedStyle(t);return ke(e["border-top-width"])+ke(e["border-bottom-width"])+ke(e["padding-top"])+ke(e["padding-bottom"])+ke(e.height)},getOffset:function(t){var e=t,n={left:0,top:0};if(e.offsetParent)do{n.left+=e.offsetLeft,n.top+=e.offsetTop,e=e.offsetParent}while(e);return n},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},Le=function(t){function e(t,n){ve(this,e);var i=Ae(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),o=i;return i.__prev=i.getValue(),i.__checkbox=document.createElement("input"),i.__checkbox.setAttribute("type","checkbox"),Oe.bind(i.__checkbox,"change",(function(){o.setValue(!o.__prev)}),!1),i.domElement.appendChild(i.__checkbox),i.updateDisplay(),i}return Ee(e,t),ye(e,[{key:"setValue",value:function(t){var n=we(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),we(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Re),Ne=function(t){function e(t,n,i){ve(this,e);var o=Ae(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=i,s=o;if(o.__select=document.createElement("select"),he.isArray(r)){var a={};he.each(r,(function(t){a[t]=t})),r=a}return he.each(r,(function(t,e){var n=document.createElement("option");n.innerHTML=e,n.setAttribute("value",t),s.__select.appendChild(n)})),o.updateDisplay(),Oe.bind(o.__select,"change",(function(){var t=this.options[this.selectedIndex].value;s.setValue(t)})),o.domElement.appendChild(o.__select),o}return Ee(e,t),ye(e,[{key:"setValue",value:function(t){var n=we(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return Oe.isActive(this.__select)?this:(this.__select.value=this.getValue(),we(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(Re),De=function(t){function e(t,n){ve(this,e);var i=Ae(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),o=i;function r(){o.setValue(o.__input.value)}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),Oe.bind(i.__input,"keyup",r),Oe.bind(i.__input,"change",r),Oe.bind(i.__input,"blur",(function(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())})),Oe.bind(i.__input,"keydown",(function(t){13===t.keyCode&&this.blur()})),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return Ee(e,t),ye(e,[{key:"updateDisplay",value:function(){return Oe.isActive(this.__input)||(this.__input.value=this.getValue()),we(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Re);function Ie(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var Be=function(t){function e(t,n,i){ve(this,e);var o=Ae(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=i||{};return o.__min=r.min,o.__max=r.max,o.__step=r.step,he.isUndefined(o.__step)?0===o.initialValue?o.__impliedStep=1:o.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(o.initialValue))/Math.LN10))/10:o.__impliedStep=o.__step,o.__precision=Ie(o.__impliedStep),o}return Ee(e,t),ye(e,[{key:"setValue",value:function(t){var n=t;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),we(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=Ie(t),this}}]),e}(Re),Me=function(t){function e(t,n,i){ve(this,e);var o=Ae(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,i));o.__truncationSuspended=!1;var r=o,s=void 0;function a(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}function c(t){var e=s-t.clientY;r.setValue(r.getValue()+e*r.__impliedStep),s=t.clientY}function l(){Oe.unbind(window,"mousemove",c),Oe.unbind(window,"mouseup",l),a()}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),Oe.bind(o.__input,"change",(function(){var t=parseFloat(r.__input.value);he.isNaN(t)||r.setValue(t)})),Oe.bind(o.__input,"blur",(function(){a()})),Oe.bind(o.__input,"mousedown",(function(t){Oe.bind(window,"mousemove",c),Oe.bind(window,"mouseup",l),s=t.clientY})),Oe.bind(o.__input,"keydown",(function(t){13===t.keyCode&&(r.__truncationSuspended=!0,this.blur(),r.__truncationSuspended=!1,a())})),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return Ee(e,t),ye(e,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():function(t,e){var n=Math.pow(10,e);return Math.round(t*n)/n}(this.getValue(),this.__precision),we(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Be);function Pe(t,e,n,i,o){return i+(t-e)/(n-e)*(o-i)}var He=function(t){function e(t,n,i,o,r){ve(this,e);var s=Ae(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,{min:i,max:o,step:r})),a=s;function c(t){t.preventDefault();var e=a.__background.getBoundingClientRect();return a.setValue(Pe(t.clientX,e.left,e.right,a.__min,a.__max)),!1}function l(){Oe.unbind(window,"mousemove",c),Oe.unbind(window,"mouseup",l),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function u(t){var e=t.touches[0].clientX,n=a.__background.getBoundingClientRect();a.setValue(Pe(e,n.left,n.right,a.__min,a.__max))}function h(){Oe.unbind(window,"touchmove",u),Oe.unbind(window,"touchend",h),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return s.__background=document.createElement("div"),s.__foreground=document.createElement("div"),Oe.bind(s.__background,"mousedown",(function(t){document.activeElement.blur(),Oe.bind(window,"mousemove",c),Oe.bind(window,"mouseup",l),c(t)})),Oe.bind(s.__background,"touchstart",(function(t){1===t.touches.length&&(Oe.bind(window,"touchmove",u),Oe.bind(window,"touchend",h),u(t))})),Oe.addClass(s.__background,"slider"),Oe.addClass(s.__foreground,"slider-fg"),s.updateDisplay(),s.__background.appendChild(s.__foreground),s.domElement.appendChild(s.__background),s}return Ee(e,t),ye(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",we(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Be),Ge=function(t){function e(t,n,i){ve(this,e);var o=Ae(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=o;return o.__button=document.createElement("div"),o.__button.innerHTML=void 0===i?"Fire":i,Oe.bind(o.__button,"click",(function(t){return t.preventDefault(),r.fire(),!1})),Oe.addClass(o.__button,"button"),o.domElement.appendChild(o.__button),o}return Ee(e,t),ye(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(Re),Ue=function(t){function e(t,n){ve(this,e);var i=Ae(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));i.__color=new xe(i.getValue()),i.__temp=new xe(0);var o=i;i.domElement=document.createElement("div"),Oe.makeSelectable(i.domElement,!1),i.__selector=document.createElement("div"),i.__selector.className="selector",i.__saturation_field=document.createElement("div"),i.__saturation_field.className="saturation-field",i.__field_knob=document.createElement("div"),i.__field_knob.className="field-knob",i.__field_knob_border="2px solid ",i.__hue_knob=document.createElement("div"),i.__hue_knob.className="hue-knob",i.__hue_field=document.createElement("div"),i.__hue_field.className="hue-field",i.__input=document.createElement("input"),i.__input.type="text",i.__input_textShadow="0 1px 1px ",Oe.bind(i.__input,"keydown",(function(t){13===t.keyCode&&h.call(this)})),Oe.bind(i.__input,"blur",h),Oe.bind(i.__selector,"mousedown",(function(){Oe.addClass(this,"drag").bind(window,"mouseup",(function(){Oe.removeClass(o.__selector,"drag")}))})),Oe.bind(i.__selector,"touchstart",(function(){Oe.addClass(this,"drag").bind(window,"touchend",(function(){Oe.removeClass(o.__selector,"drag")}))}));var r,s=document.createElement("div");function a(t){f(t),Oe.bind(window,"mousemove",f),Oe.bind(window,"touchmove",f),Oe.bind(window,"mouseup",l),Oe.bind(window,"touchend",l)}function c(t){p(t),Oe.bind(window,"mousemove",p),Oe.bind(window,"touchmove",p),Oe.bind(window,"mouseup",u),Oe.bind(window,"touchend",u)}function l(){Oe.unbind(window,"mousemove",f),Oe.unbind(window,"touchmove",f),Oe.unbind(window,"mouseup",l),Oe.unbind(window,"touchend",l),d()}function u(){Oe.unbind(window,"mousemove",p),Oe.unbind(window,"touchmove",p),Oe.unbind(window,"mouseup",u),Oe.unbind(window,"touchend",u),d()}function h(){var t=me(this.value);!1!==t?(o.__color.__state=t,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function d(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}function f(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=o.__saturation_field.getBoundingClientRect(),n=t.touches&&t.touches[0]||t,i=n.clientX,r=n.clientY,s=(i-e.left)/(e.right-e.left),a=1-(r-e.top)/(e.bottom-e.top);return a>1?a=1:a<0&&(a=0),s>1?s=1:s<0&&(s=0),o.__color.v=a,o.__color.s=s,o.setValue(o.__color.toOriginal()),!1}function p(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=o.__hue_field.getBoundingClientRect(),n=1-((t.touches&&t.touches[0]||t).clientY-e.top)/(e.bottom-e.top);return n>1?n=1:n<0&&(n=0),o.__color.h=360*n,o.setValue(o.__color.toOriginal()),!1}return he.extend(i.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),he.extend(i.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:i.__field_knob_border+(i.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),he.extend(i.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),he.extend(i.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),he.extend(s.style,{width:"100%",height:"100%",background:"none"}),Ve(s,"top","rgba(0,0,0,0)","#000"),he.extend(i.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(r=i.__hue_field).style.background="",r.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",r.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",he.extend(i.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:i.__input_textShadow+"rgba(0,0,0,0.7)"}),Oe.bind(i.__saturation_field,"mousedown",a),Oe.bind(i.__saturation_field,"touchstart",a),Oe.bind(i.__field_knob,"mousedown",a),Oe.bind(i.__field_knob,"touchstart",a),Oe.bind(i.__hue_field,"mousedown",c),Oe.bind(i.__hue_field,"touchstart",c),i.__saturation_field.appendChild(s),i.__selector.appendChild(i.__field_knob),i.__selector.appendChild(i.__saturation_field),i.__selector.appendChild(i.__hue_field),i.__hue_field.appendChild(i.__hue_knob),i.domElement.appendChild(i.__input),i.domElement.appendChild(i.__selector),i.updateDisplay(),i}return Ee(e,t),ye(e,[{key:"updateDisplay",value:function(){var t=me(this.getValue());if(!1!==t){var e=!1;he.each(xe.COMPONENTS,(function(n){if(!he.isUndefined(t[n])&&!he.isUndefined(this.__color.__state[n])&&t[n]!==this.__color.__state[n])return e=!0,{}}),this),e&&he.extend(this.__color.__state,t)}he.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,i=255-n;he.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,Ve(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),he.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+i+","+i+","+i+",.7)"})}}]),e}(Re),je=["-moz-","-o-","-webkit-","-ms-",""];function Ve(t,e,n,i){t.style.background="",he.each(je,(function(o){t.style.cssText+="background: "+o+"linear-gradient("+e+", "+n+" 0%, "+i+" 100%); "}))}var We='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',ze=function(t,e){var n=t[e];return he.isArray(arguments[2])||he.isObject(arguments[2])?new Ne(t,e,arguments[2]):he.isNumber(n)?he.isNumber(arguments[2])&&he.isNumber(arguments[3])?he.isNumber(arguments[4])?new He(t,e,arguments[2],arguments[3],arguments[4]):new He(t,e,arguments[2],arguments[3]):he.isNumber(arguments[4])?new Me(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new Me(t,e,{min:arguments[2],max:arguments[3]}):he.isString(n)?new De(t,e):he.isFunction(n)?new Ge(t,e,""):he.isBoolean(n)?new Le(t,e):null},Ye=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},qe=function(){function t(){ve(this,t),this.backgroundElement=document.createElement("div"),he.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),Oe.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),he.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;Oe.bind(this.backgroundElement,"click",(function(){e.hide()}))}return ye(t,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),he.defer((function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",Oe.unbind(t.domElement,"webkitTransitionEnd",e),Oe.unbind(t.domElement,"transitionend",e),Oe.unbind(t.domElement,"oTransitionEnd",e)};Oe.bind(this.domElement,"webkitTransitionEnd",e),Oe.bind(this.domElement,"transitionend",e),Oe.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-Oe.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-Oe.getHeight(this.domElement)/2+"px"}}]),t}();!function(t,e){var n=e||document,i=document.createElement("style");i.type="text/css",i.innerHTML=t;var o=n.getElementsByTagName("head")[0];try{o.appendChild(i)}catch(t){}}(function(t){if("undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var Ke="Default",Xe=function(){try{return!!window.localStorage}catch(t){return!1}}(),$e=void 0,Qe=!0,Je=void 0,Ze=!1,tn=[],en=function t(e){var n=this,i=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),Oe.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],i=he.defaults(i,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),i=he.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace}),he.isUndefined(i.load)?i.load={preset:Ke}:i.preset&&(i.load.preset=i.preset),he.isUndefined(i.parent)&&i.hideable&&tn.push(this),i.resizable=he.isUndefined(i.parent)&&i.resizable,i.autoPlace&&he.isUndefined(i.scrollable)&&(i.scrollable=!0);var o,r=Xe&&"true"===localStorage.getItem(cn(0,"isLocal")),s=void 0,a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return i.parent}},scrollable:{get:function(){return i.scrollable}},autoPlace:{get:function(){return i.autoPlace}},closeOnTop:{get:function(){return i.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:i.load.preset},set:function(t){n.parent?n.getRoot().preset=t:i.load.preset=t,function(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}(this),n.revert()}},width:{get:function(){return i.width},set:function(t){i.width=t,fn(n,t)}},name:{get:function(){return i.name},set:function(t){i.name=t,a&&(a.innerHTML=i.name)}},closed:{get:function(){return i.closed},set:function(e){i.closed=e,i.closed?Oe.addClass(n.__ul,t.CLASS_CLOSED):Oe.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return i.load}},useLocalStorage:{get:function(){return r},set:function(t){Xe&&(r=t,t?Oe.bind(window,"unload",s):Oe.unbind(window,"unload",s),localStorage.setItem(cn(0,"isLocal"),t))}}}),he.isUndefined(i.parent)){if(this.closed=i.closed||!1,Oe.addClass(this.domElement,t.CLASS_MAIN),Oe.makeSelectable(this.domElement,!1),Xe&&r){n.useLocalStorage=!0;var c=localStorage.getItem(cn(0,"gui"));c&&(i.load=JSON.parse(c))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,Oe.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),i.closeOnTop?(Oe.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(Oe.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),Oe.bind(this.__closeButton,"click",(function(){n.closed=!n.closed}))}else{void 0===i.closed&&(i.closed=!0);var l=document.createTextNode(i.name);Oe.addClass(l,"controller-name"),a=nn(n,l),Oe.addClass(this.__ul,t.CLASS_CLOSED),Oe.addClass(a,"title"),Oe.bind(a,"click",(function(t){return t.preventDefault(),n.closed=!n.closed,!1})),i.closed||(this.closed=!1)}i.autoPlace&&(he.isUndefined(i.parent)&&(Qe&&(Je=document.createElement("div"),Oe.addClass(Je,"dg"),Oe.addClass(Je,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Je),Qe=!1),Je.appendChild(this.domElement),Oe.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||fn(n,i.width)),this.__resizeHandler=function(){n.onResizeDebounced()},Oe.bind(window,"resize",this.__resizeHandler),Oe.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),Oe.bind(this.__ul,"transitionend",this.__resizeHandler),Oe.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),i.resizable&&dn(this),s=function(){Xe&&"true"===localStorage.getItem(cn(0,"isLocal"))&&localStorage.setItem(cn(0,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=s,i.parent||((o=n.getRoot()).width+=1,he.defer((function(){o.width-=1})))};function nn(t,e,n){var i=document.createElement("li");return e&&i.appendChild(e),n?t.__ul.insertBefore(i,n):t.__ul.appendChild(i),t.onResize(),i}function on(t){Oe.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&Oe.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function rn(t,e){var n=t.__preset_select[t.__preset_select.selectedIndex];n.innerHTML=e?n.value+"*":n.value}function sn(t,e){var n=t.getRoot(),i=n.__rememberedObjects.indexOf(e.object);if(-1!==i){var o=n.__rememberedObjectIndecesToControllers[i];if(void 0===o&&(o={},n.__rememberedObjectIndecesToControllers[i]=o),o[e.property]=e,n.load&&n.load.remembered){var r=n.load.remembered,s=void 0;if(r[t.preset])s=r[t.preset];else{if(!r.Default)return;s=r.Default}if(s[i]&&void 0!==s[i][e.property]){var a=s[i][e.property];e.initialValue=a,e.setValue(a)}}}}function an(t,e,n,i){if(void 0===e[n])throw new Error('Object "'+e+'" has no property "'+n+'"');var o=void 0;if(i.color)o=new Ue(e,n);else{var r=[e,n].concat(i.factoryArgs);o=ze.apply(t,r)}i.before instanceof Re&&(i.before=i.before.__li),sn(t,o),Oe.addClass(o.domElement,"c");var s=document.createElement("span");Oe.addClass(s,"property-name"),s.innerHTML=o.property;var a=document.createElement("div");a.appendChild(s),a.appendChild(o.domElement);var c=nn(t,a,i.before);return Oe.addClass(c,en.CLASS_CONTROLLER_ROW),o instanceof Ue?Oe.addClass(c,"color"):Oe.addClass(c,be(o.getValue())),function(t,e,n){if(n.__li=e,n.__gui=t,he.extend(n,{options:function(e){if(arguments.length>1){var i=n.__li.nextElementSibling;return n.remove(),an(t,n.object,n.property,{before:i,factoryArgs:[he.toArray(arguments)]})}if(he.isArray(e)||he.isObject(e)){var o=n.__li.nextElementSibling;return n.remove(),an(t,n.object,n.property,{before:o,factoryArgs:[e]})}},name:function(t){return n.__li.firstElementChild.firstElementChild.innerHTML=t,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof He){var i=new Me(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});he.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(t){var e=n[t],o=i[t];n[t]=i[t]=function(){var t=Array.prototype.slice.call(arguments);return o.apply(i,t),e.apply(n,t)}})),Oe.addClass(e,"has-slider"),n.domElement.insertBefore(i.domElement,n.domElement.firstElementChild)}else if(n instanceof Me){var o=function(e){if(he.isNumber(n.__min)&&he.isNumber(n.__max)){var i=n.__li.firstElementChild.firstElementChild.innerHTML,o=n.__gui.__listening.indexOf(n)>-1;n.remove();var r=an(t,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return r.name(i),o&&r.listen(),r}return e};n.min=he.compose(o,n.min),n.max=he.compose(o,n.max)}else n instanceof Le?(Oe.bind(e,"click",(function(){Oe.fakeEvent(n.__checkbox,"click")})),Oe.bind(n.__checkbox,"click",(function(t){t.stopPropagation()}))):n instanceof Ge?(Oe.bind(e,"click",(function(){Oe.fakeEvent(n.__button,"click")})),Oe.bind(e,"mouseover",(function(){Oe.addClass(n.__button,"hover")})),Oe.bind(e,"mouseout",(function(){Oe.removeClass(n.__button,"hover")}))):n instanceof Ue&&(Oe.addClass(e,"color"),n.updateDisplay=he.compose((function(t){return e.style.borderLeftColor=n.__color.toString(),t}),n.updateDisplay),n.updateDisplay());n.setValue=he.compose((function(e){return t.getRoot().__preset_select&&n.isModified()&&rn(t.getRoot(),!0),e}),n.setValue)}(t,c,o),t.__controllers.push(o),o}function cn(t,e){return document.location.href+"."+e}function ln(t,e,n){var i=document.createElement("option");i.innerHTML=e,i.value=e,t.__preset_select.appendChild(i),n&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function un(t,e){e.style.display=t.useLocalStorage?"block":"none"}function hn(t){var e=t.__save_row=document.createElement("li");Oe.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),Oe.addClass(e,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",Oe.addClass(n,"button gears");var i=document.createElement("span");i.innerHTML="Save",Oe.addClass(i,"button"),Oe.addClass(i,"save");var o=document.createElement("span");o.innerHTML="New",Oe.addClass(o,"button"),Oe.addClass(o,"save-as");var r=document.createElement("span");r.innerHTML="Revert",Oe.addClass(r,"button"),Oe.addClass(r,"revert");var s=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?he.each(t.load.remembered,(function(e,n){ln(t,n,n===t.preset)})):ln(t,Ke,!1),Oe.bind(s,"change",(function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value})),e.appendChild(s),e.appendChild(n),e.appendChild(i),e.appendChild(o),e.appendChild(r),Xe){var a=document.getElementById("dg-local-explain"),c=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(cn(0,"isLocal"))&&c.setAttribute("checked","checked"),un(t,a),Oe.bind(c,"change",(function(){t.useLocalStorage=!t.useLocalStorage,un(t,a)}))}var l=document.getElementById("dg-new-constructor");Oe.bind(l,"keydown",(function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||$e.hide()})),Oe.bind(n,"click",(function(){l.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),$e.show(),l.focus(),l.select()})),Oe.bind(i,"click",(function(){t.save()})),Oe.bind(o,"click",(function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)})),Oe.bind(r,"click",(function(){t.revert()}))}function dn(t){var e=void 0;function n(n){return n.preventDefault(),t.width+=e-n.clientX,t.onResize(),e=n.clientX,!1}function i(){Oe.removeClass(t.__closeButton,en.CLASS_DRAG),Oe.unbind(window,"mousemove",n),Oe.unbind(window,"mouseup",i)}function o(o){return o.preventDefault(),e=o.clientX,Oe.addClass(t.__closeButton,en.CLASS_DRAG),Oe.bind(window,"mousemove",n),Oe.bind(window,"mouseup",i),!1}t.__resize_handle=document.createElement("div"),he.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),Oe.bind(t.__resize_handle,"mousedown",o),Oe.bind(t.__closeButton,"mousedown",o),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function fn(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function pn(t,e){var n={};return he.each(t.__rememberedObjects,(function(i,o){var r={},s=t.__rememberedObjectIndecesToControllers[o];he.each(s,(function(t,n){r[n]=e?t.initialValue:t.getValue()})),n[o]=r})),n}function mn(t){0!==t.length&&Ye.call(window,(function(){mn(t)})),he.each(t,(function(t){t.updateDisplay()}))}en.toggleHide=function(){Ze=!Ze,he.each(tn,(function(t){t.domElement.style.display=Ze?"none":""}))},en.CLASS_AUTO_PLACE="a",en.CLASS_AUTO_PLACE_CONTAINER="ac",en.CLASS_MAIN="main",en.CLASS_CONTROLLER_ROW="cr",en.CLASS_TOO_TALL="taller-than-window",en.CLASS_CLOSED="closed",en.CLASS_CLOSE_BUTTON="close-button",en.CLASS_CLOSE_TOP="close-top",en.CLASS_CLOSE_BOTTOM="close-bottom",en.CLASS_DRAG="drag",en.DEFAULT_WIDTH=245,en.TEXT_CLOSED="Close Controls",en.TEXT_OPEN="Open Controls",en._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||en.toggleHide()},Oe.bind(window,"keydown",en._keydownHandler,!1),he.extend(en.prototype,{add:function(t,e){return an(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return an(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;he.defer((function(){e.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Je.removeChild(this.domElement);var t=this;he.each(this.__folders,(function(e){t.removeFolder(e)})),Oe.unbind(window,"keydown",en._keydownHandler,!1),on(this)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var n=new en(e);this.__folders[t]=n;var i=nn(this,n.domElement);return Oe.addClass(i,"folder"),n},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],on(t);var e=this;he.each(t.__folders,(function(e){t.removeFolder(e)})),he.defer((function(){e.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=Oe.getOffset(t.__ul).top,n=0;he.each(t.__ul.childNodes,(function(e){t.autoPlace&&e===t.__save_row||(n+=Oe.getHeight(e))})),window.innerHeight-e-20<n?(Oe.addClass(t.domElement,en.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(Oe.removeClass(t.domElement,en.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&he.defer((function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"})),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:he.debounce((function(){this.onResize()}),50),remember:function(){if(he.isUndefined($e)&&(($e=new qe).domElement.innerHTML=We),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;he.each(Array.prototype.slice.call(arguments),(function(e){0===t.__rememberedObjects.length&&hn(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)})),this.autoPlace&&fn(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=pn(this)),t.folders={},he.each(this.__folders,(function(e,n){t.folders[n]=e.getSaveObject()})),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=pn(this),rn(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=pn(this,!0)),this.load.remembered[t]=pn(this),this.preset=t,ln(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){he.each(this.__controllers,(function(e){this.getRoot().load.remembered?sn(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())}),this),he.each(this.__folders,(function(t){t.revert(t)})),t||rn(this.getRoot(),!1)},listen:function(t){var e=0===this.__listening.length;this.__listening.push(t),e&&mn(this.__listening)},updateDisplay:function(){he.each(this.__controllers,(function(t){t.updateDisplay()})),he.each(this.__folders,(function(t){t.updateDisplay()}))}});const gn=new en;window.qd=e})();