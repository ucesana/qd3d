<!DOCTYPE html>
<html>
<head>
    <title>Quick and Dirty 3D</title>

    <link rel="icon" href="qd.ico">

    <meta charset="UTF-8">

    <style>
        body {
            margin: 0px;
            padding: 0px;
            overflow: hidden;
        }

        .viewport {
            border: thin solid black;
            box-shadow: 10px 10px 5px #888888;
        }

        .centre {
            margin: 0;
            position: absolute;
            top: 50%;
            left: 50%;
            -ms-transform: translate(-50%, -50%);
            transform: translate(-50%, -50%);
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <canvas id="viewport" class="viewport centre hidden" title="Drop OBJ and texture files here"></canvas>
    <script src="https://cdn.jsdelivr.net/npm/noisejs@2.1.0/index.min.js"></script>
    <script type="text/javascript" src="main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Setup viewport dimensions

            // const aspectRatio = 1;
            // const aspectRatio = 4/3;
            // const aspectRatio = 5/4;
            // const aspectRatio = 16/10;
            const aspectRatio = 16/9;

            // canvas pixels / viewport pixels
            const pixelDensity = 1;

            // canvas width and height
            const width = 1920;
            // const width = 1440;
            // const width = 640;
            const height = Math.floor(width * (1 / aspectRatio));

            // Setup World

            const objectFactory = new qd.ObjectFactory();
            const cube1 = objectFactory.cube( {colour: {red: 1, green: 0.25, blue: 0.1}});
            cube1.position = qd.Vec3.create(0, 0, 0);
            cube1.rotation = qd.Vec3.create(1, 1, 1);

            const cube2 = objectFactory.cube({colour: {red: 0.25, green: 0.5, blue: 1}});
            cube2.position = qd.Vec3.create(2, 0, -12);

            const world = new qd.World();
            // world.objects.push(cube1);
            //world.objects.push(cube2);

            world.import(objectFactory.perlinSphere(8, 8, 8), "mesh");

            const lightA = qd.Light.distant( {
                red: 1,
                green: 0,
                blue: 0,
                intensity: 4,
                direction: qd.Vec3.normalised(qd.Vec3.create(1, 0, 0))
            });

            const lightB = qd.Light.distant({
                red: 0,
                green: 1,
                blue: 0,
                intensity: 4,
                direction: qd.Vec3.normalised(qd.Vec3.create(0, 1, 0))
            });

            const lightC = qd.Light.distant({
                red: 0,
                green: 0,
                blue: 1,
                intensity: 4,
                direction: qd.Vec3.normalised(qd.Vec3.create(0, 0, 1))
            });

            const pointLightB = qd.Light.point({
                red: 1,
                green: 0,
                blue: 0,
                intensity: 100000,
                position: qd.Vec3.create(100, 0, 0)
            });

            const pointLightC = qd.Light.point({
                red: 0,
                green: 1,
                blue: 0,
                intensity: 100000,
                position: qd.Vec3.create(-100, 0, 0)
            });

            const pointLightA = qd.Light.point({
                red: 0,
                green: 0,
                blue: 1,
                intensity: 100000,
                position: qd.Vec3.create()
            });

            const lightAGui = new qd.LightColourGuiAdaptor(lightA);
            const lightBGui = new qd.LightColourGuiAdaptor(lightB);
            const lightCGui = new qd.LightColourGuiAdaptor(lightC);

            const pointLightAGui = new qd.LightColourGuiAdaptor(pointLightA);
            const pointLightBGui = new qd.LightColourGuiAdaptor(pointLightB);
            const pointLightCGui = new qd.LightColourGuiAdaptor(pointLightC);

            const pointLightAPosXGui = new qd.LightPositionGuiAdaptor(pointLightA, 0);
            const pointLightAPosYGui = new qd.LightPositionGuiAdaptor(pointLightA, 1);
            const pointLightAPosZGui = new qd.LightPositionGuiAdaptor(pointLightA, 2);

            const pointLightBPosXGui = new qd.LightPositionGuiAdaptor(pointLightB, 0);
            const pointLightBPosYGui = new qd.LightPositionGuiAdaptor(pointLightB, 1);
            const pointLightBPosZGui = new qd.LightPositionGuiAdaptor(pointLightB, 2);

            const pointLightCPosXGui = new qd.LightPositionGuiAdaptor(pointLightC, 0);
            const pointLightCPosYGui = new qd.LightPositionGuiAdaptor(pointLightC, 1);
            const pointLightCPosZGui = new qd.LightPositionGuiAdaptor(pointLightC, 2);

            const directionalLightsFolder = qd.gui.addFolder("Directional Lights");

            const directionalLightAFolder = directionalLightsFolder.addFolder("Light A");
            directionalLightAFolder.addColor(lightAGui, 'value').name('Colour A');
            directionalLightAFolder.add(lightA, 'intensity', 0, 100000, 100).name('Intensity A');

            const directionalLightBFolder = directionalLightsFolder.addFolder("Light B");
            directionalLightBFolder.addColor(lightBGui, 'value').name('Colour B');
            directionalLightBFolder.add(lightB, 'intensity', 0, 100000, 100).name('Intensity B');

            const directionalLightCFolder = directionalLightsFolder.addFolder("Light C");
            directionalLightCFolder.addColor(lightCGui, 'value').name('Colour C');
            directionalLightCFolder.add(lightC, 'intensity', 0, 100000, 100).name('Intensity C');

            const pointLightsFolder = qd.gui.addFolder("Point Lights");

            const pointLightsAFolder = pointLightsFolder.addFolder("Light A");
            pointLightsAFolder.addColor(pointLightAGui, 'value').name('Colour A');
            pointLightsAFolder.add(pointLightA, 'intensity', 0, 10, 0.1).name('Intensity A');
            pointLightsAFolder.add(pointLightAPosXGui, 'value').name('x');
            pointLightsAFolder.add(pointLightAPosYGui, 'value').name('y');
            pointLightsAFolder.add(pointLightAPosZGui, 'value').name('z');

            const pointLightsBFolder = pointLightsFolder.addFolder("Light B");
            pointLightsBFolder.addColor(pointLightBGui, 'value').name('Colour B');
            pointLightsBFolder.add(pointLightB, 'intensity', 0, 10, 0.1).name('Intensity B');
            pointLightsBFolder.add(pointLightBPosXGui, 'value').name('x');
            pointLightsBFolder.add(pointLightBPosYGui, 'value').name('y');
            pointLightsBFolder.add(pointLightBPosZGui, 'value').name('z');

            const pointLightsCFolder = pointLightsFolder.addFolder("Light C");
            pointLightsCFolder.addColor(pointLightCGui, 'value').name('Colour C');
            pointLightsCFolder.add(pointLightC, 'intensity', 0, 10, 0.1).name('Intensity C');
            pointLightsCFolder.add(pointLightCPosXGui, 'value').name('x');
            pointLightsCFolder.add(pointLightCPosYGui, 'value').name('y');
            pointLightsCFolder.add(pointLightCPosZGui, 'value').name('z');

            world
                .light(qd.Light.ambient({red: 1, green: 1, blue: 1, intensity: 0.25}))
                .light(lightA)
                .light(lightB)
                .light(lightC);
                // .light(pointLightA)
                // .light(pointLightB)
                // .light(pointLightC);

            const options = {
                canvas: "viewport",
                width: width,
                height: height,
                pixelWidth: pixelDensity,
                pixelHeight: pixelDensity,
                fNear: 1,
                fFar: 2000,
                fov: 90,
                showWireframe: false,
                showFaces: true,
                wireframeColour: qd.Colour.ORANGE,
                backfaceCulling: false,
                reverseYAxis: true,
                translationSpeed: 0.015,
                rotationSpeed: 0.0001,
                globalRotation: 0,
                globalRotationSpeed: 0.001,
                backgroundColour: qd.Colour.of(0, 0, 0, 1),
                world: world,
                renderer: "raster"
            };

            const engine = new qd.Engine(options);

            if (engine.renderer.settings.renderer === 'vector') {
                const wireframeFolder = qd.gui.addFolder("Wireframe");
                wireframeFolder.add(engine.renderer.settings, 'showWireframe').name('Show/hide wireframe');
                wireframeFolder.addColor(engine.renderer.settings, 'wireframeColour').name("Wireframe colour");
            }

            engine.run();
            document.getElementById("viewport").classList.remove("hidden");
        }, false);
    </script>
</body>
</html>
